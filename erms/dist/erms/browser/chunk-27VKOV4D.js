import{A as b,Aa as O,Ba as F,Ca as D,Da as N,Ea as H,Fa as M,Ga as W,Ha as K,Ia as V,Ja as G,Ka as B,La as J,Ma as Q,Na as q,Oa as z,P as _,Pa as X,Qa as Y,Ra as Z,Rb as le,Sa as ee,Ta as te,Ua as re,Ub as u,Va as se,Wa as oe,Xa as ie,Ya as ne,Za as ae,bc as de,ca as $,da as U,eb as ce,qa as I,s as P,ua as j,w as T,x,xb as ue,y as g,ya as o,za as L}from"./chunk-HOMEJTDX.js";import{K as E,g as v,ra as y,s as w,w as S,wa as l}from"./chunk-RKO2T376.js";import{a as s,b as n}from"./chunk-R6IFIPMG.js";var h={accessToken:null,refreshToken:null,isAuthenticated:!1,message:null,errorRegister:null,messageRegister:null,status:"idle",isRecoveringPassword:!1,isRecoveredPassword:!1,isHasConditionRegister:!1,statusCode:x.UNKNOWN_ERROR},he=L(h,o(O,(e,t)=>n(s({},e),{status:"loading"})),o(F,(e,t)=>n(s({},e),{status:"loaded",accessToken:t.accessToken,refreshToken:t.refreshToken,isAuthenticated:!0,message:"ok"})),o(D,(e,t)=>n(s({},e),{status:"error",message:t.error})),o(N,(e,t)=>n(s({},e),{status:"loading"})),o(H,(e,t)=>n(s({},e),{status:"loaded",accessToken:t.accessToken,isAuthenticated:!0,message:"ok"})),o(M,(e,t)=>n(s({},e),{status:"error",message:t.error})),o(W,e=>n(s({},e),{status:"loading"})),o(K,e=>n(s({},e),{status:"loaded",isRecoveringPassword:!0,message:"ok email is isExist"})),o(V,(e,t)=>n(s({},e),{status:"error",message:t.error})),o(G,(e,t)=>n(s({},e),{status:"loading"})),o(B,(e,t)=>n(s({},e),{status:"loaded",isRecoveringPassword:!1,isRecoveredPassword:!0})),o(J,(e,t)=>n(s({},e),{status:"error",message:t.error})),o(Q,(e,t)=>n(s({},e),{status:"loading"})),o(q,(e,t)=>n(s({},e),{isRecoveringPassword:!0,status:"loaded"})),o(z,(e,t)=>n(s({},e),{status:"error"})),o(X,(e,t)=>n(s({},e),{status:"loading"})),o(Y,(e,t)=>n(s({},e),{messageRegister:t.message,status:"loaded"})),o(Z,(e,t)=>n(s({},e),{errorRegister:t.error,status:"error"})),o(ee,(e,t)=>s({},h)),o(te,(e,t)=>n(s({},e),{status:"loading"})),o(re,(e,t)=>n(s({},h),{message:"M\xE3 x\xE1c minh \u0111\xE3 \u0111\u01B0\u1EE3c g\u1EEDi \u0111\u1EBFn h\u1ED9p th\u01B0 \u0111\u1EBFn c\u1EE7a b\u1EA1n",status:"loaded",statusCode:t.statusCode})),o(se,(e,{error:t})=>n(s({},h),{message:t instanceof Array?"arr error message":t,status:"loading"})),o(oe,(e,t)=>n(s({},e),{status:"loading"})),o(ie,(e,t)=>n(s({},e),{isHasConditionRegister:!0,message:"Email h\u1EE3p l\u1EC7, ti\u1EBFp t\u1EE5c \u0111\u0103ng k\xFD n\xE0o",status:"loaded",statusCode:t.statusCode})),o(ne,(e,{error:t})=>n(s({},h),{message:t,status:"loading"})),o(ae,()=>s({},h)));var fe=j({name:ce.authFeature,reducer:he}),{selectAccessToken:be,selectIsAuthenticated:me,selectMessage:_e,selectStatus:$e,selectMessageRegister:Ue,selectErrorRegister:Ie,selectIsRecoveringPassword:je,selectIsHasConditionRegister:Le,selectStatusCode:Oe}=fe;var p="ERMS_",pe=e=>{let t=`${p}${e}=`,c=document.cookie.split(";");for(let r of c){let i=r;for(;i.charAt(0)===" ";)i=i.substring(1,i.length);if(i.indexOf(t)===0)return i.substring(t.length,i.length)}return null},Ae=e=>{let t=e.startsWith(p)?e:`${p}${e}`;document.cookie=`${t}=;expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/`},ge=(e=[])=>{let t=document.cookie.split(";");for(let c of t){let[r]=c.split("=");!e.includes(r.trim())&&Ae(r)}},k=(e,t,c,r)=>{let i=e.startsWith(p)?e:`${p}${e}`,a=c?new Date(c*1e3):new Date;c||a.setTime(a.getTime()+365*24*60*60*1e3),document.cookie=`${i}=${t};expires=${a.toUTCString()}; domain=${le.baseDomain}; path=${r??"/"}`};var d=class extends Error{};d.prototype.name="InvalidTokenError";function ke(e){return decodeURIComponent(atob(e).replace(/(.)/g,(t,c)=>{let r=c.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function Ce(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return ke(t)}catch{return atob(t)}}function C(e,t){if(typeof e!="string")throw new d("Invalid token specified: must be a string");t||(t={});let c=t.header===!0?0:1,r=e.split(".")[c];if(typeof r!="string")throw new d(`Invalid token specified: missing part #${c+1}`);let i;try{i=Ce(r)}catch(a){throw new d(`Invalid token specified: invalid base64 for part #${c+1} (${a.message})`)}try{return JSON.parse(i)}catch(a){throw new d(`Invalid token specified: invalid json for part #${c+1} (${a.message})`)}}var rt=(()=>{let t=class t{constructor(r,i,a,f,R,A,m){this.httpClient=r,this.router=i,this.store=a,this.userProfileService=f,this.storageService=R,this.errorPage=A,this.userFireStoreService=m,this.routerLinkRedirectURLSubject=new v(""),this.routerLinkRedirectURL$=this.routerLinkRedirectURLSubject.asObservable()}get token(){return pe(g.ACCESS_TOKEN)}get isAuthenticated$(){return this.store.select(me)}checkUserLogin$(r,i){let a=r.data,f=[].concat(this.userProfileService.roleCurrentUser??[]),A=(Array.isArray(a.expectedRole)?a.expectedRole:[]).some((m,Re)=>f.includes(m));return this.isAuthenticated$.pipe(S(m=>m?A?!0:(this.errorPage.setErrorCode(T.FORBIDDEN),this.router.navigate(["error"]),!1):(this.router.navigate(["auth/login"]),!1)))}decodedTokenToGiveInfo(r){return C(r)}isTokenExpired(){if(!this.token)return!0;try{let{exp:r}=C(this.token);return r?Math.floor(new Date().getTime()/1e3)>=r:!0}catch(r){return console.error("Invalid token:",r),!0}}startSession(r,i){let a=this.decodedTokenToGiveInfo(r);k(g.ACCESS_TOKEN,r,a.exp,"/"),k(g.REFRESH_TOKEN,i,null,"/"),this.userFireStoreService.addUserInToFireStore({displayName:a.FullName,photoURL:a.Avatar,uid:a.UserId}),this.storageService.set(b.currentUser,JSON.stringify(a)),this.redirectToPageAfter()}redirectToPageAfter(){this.routerLinkRedirectURL$.subscribe(r=>{let i=r?this.router.parseUrl(r):"/common/home";this.router.navigateByUrl(i)})}endSession(){ge(),window.localStorage.clear(),window.location.href="/common/home"}login(r){return this.httpClient.post(u.Login.api,r).pipe(E(i=>(console.error("Error in login service:",i),w(()=>i))))}loginwithGoogle(r){return this.httpClient.post(u.LoginOther.api,r)}logout(){this.endSession()}forgotPassWord(r){return this.httpClient.post(u.ForgotPassWord.api,r)}resetPassword(r){return this.httpClient.post(u.ResetPassWord.api,r)}register(r){return this.httpClient.post(u.Register.api,r)}changepassword(r){return this.httpClient.post(u.ChangePassword.api,r)}verifyEmail(r){return this.httpClient.post(u.VerifyEmail.api,r)}isExistEmail(r){return this.httpClient.post(u.IsExistEmail.api,r)}confirmVerifyEmail(r){return this.httpClient.post(u.ConfirmEmail.api,r)}};t.\u0275fac=function(i){return new(i||t)(l(de),l(P),l(I),l(U),l($),l(_),l(ue))},t.\u0275prov=y({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();export{fe as a,$e as b,je as c,Oe as d,pe as e,Ae as f,rt as g};
