import"./chunk-R7ZMMJMA.js";import{a as uc,g as Oe}from"./chunk-KJ6DH26Q.js";import{a as lc}from"./chunk-B54KBANF.js";import{a as _c,b as mc}from"./chunk-WA2TOHGR.js";import{a as x,b as Bn,c as D,d as pc}from"./chunk-VNM6WABZ.js";import{$ as oa,$b as Un,Aa as Ta,Ba as xi,Ca as In,Da as Ca,Ea as Di,Fa as Mi,Ga as Sa,H as Yo,Ha as Li,I as Qo,Ia as Fi,J as Xo,Ja as Ia,K as Zo,Ka as Ui,L as Jo,La as Bi,Lb as rc,M as ea,N as Oi,Na as ba,O as Tn,Oa as Aa,P as rt,Pa as Ra,Q as ta,Qa as bn,R as na,Ra as An,Rb as qi,Sa as ka,Ta as Na,U as ia,Ua as Wi,Ub as Pe,Va as Lt,W as sa,Wa as Pa,Wb as Fn,Xa as Oa,Xb as Hi,Ya as xa,Yb as oc,_ as ra,_b as ac,aa,ab as Da,b as Do,ba as ca,bc as cc,bd as Gi,ca as la,d as Mo,da as ua,db as Ma,e as Lo,ea as ha,f as Fo,fa as Q,fb as La,g as Uo,ga as ie,gb as Fa,gc as hc,h as Bo,ha as xt,hb as Ua,i as Wo,ia as Cn,ib as at,ic as dc,j as $o,ja as da,jb as ec,k as jo,ka as fa,kb as ct,l as Ai,la as pa,lb as lt,m as zo,ma as _a,mb as Mn,n as Vo,na as Dt,nb as ut,ne as fc,o as Ri,oa as ma,ob as ht,oe as pt,p as ki,pa as ga,pb as dt,q as qo,qa as Sn,qb as ft,r as En,ra as ya,rb as tc,s as de,sa as va,sb as nc,t as Ho,tb as Ln,u as Go,ua as wa,ub as ic,v as Ni,vb as sc,wb as Vi,x as Pi,xa as Mt,y as Ko,ya as be,z as Ie,za as Ea}from"./chunk-UN23QMYQ.js";import{$b as I,Ac as Io,Ad as Po,Ba as fo,Bb as vo,Cb as Se,E as so,Ea as yn,Ec as F,Ed as Oo,Fa as Ce,Fc as bo,G as Si,H as nt,Ia as ue,Ic as Ao,Jc as Ro,K as B,Kd as xo,L as ro,Mb as wo,N as oo,Ob as G,P as mn,S as ao,Ta as po,Va as it,Wa as vn,Xc as ko,ac as K,bc as ne,bd as wn,c as Ci,cc as Ii,da as co,db as _o,dc as bi,ea as lo,ga as uo,h as Zr,ia as H,ic as Eo,ka as gn,kc as To,l as Jr,ma as L,n as eo,na as Ot,o as to,oa as ho,od as No,r as U,ra as Y,s as me,sa as Te,tb as oe,ua as re,ub as st,uc as he,v as no,vb as mo,w as O,wa as v,xa as te,xb as go,y as io,yc as Co,za as ce,zb as yo,zc as So}from"./chunk-RKO2T376.js";import{B as Ka,C as Ya,D as Qa,E as Xa,F as Ut,G as Ve,H as ke,I as Za,J as Ja,K as Bt,L as xn,M as Ne,N as Me,O as Dn,Q as qe,S as $,a as p,b as ot,c as Ba,d as Wa,e as $a,f as Rn,g as $i,h as kn,j as ji,k as ja,l as Ae,n as za,o as Va,p as qa,q as Nn,r as Pn,s as On,t as W,u as Ha,v as Ga,w as Re,x as ze,y as zi,z as Ft}from"./chunk-Z4ODKDNE.js";import{a as P,b as q,c as Xr,h as g}from"./chunk-R6IFIPMG.js";var td=()=>["../common/home"],nd=()=>["./manage-users"],_t=()=>({exact:!0}),id=()=>["./manage-register-lessor"],sd=()=>["./manage-shops"],rd=()=>["./manage-category"],od=()=>["./dashboard"],ad=()=>["./order"],Ki=()=>({exact:!1}),cd=()=>["./notification"],ld=t=>["/lessor/shop",t],ud=()=>["/lessor/voucher"];function hd(t,e){t&1&&(Ii(0),I(1,"li",8),ne(2,"span",9),I(3,"span"),he(4,"Th\u1ED1ng K\xEA"),K()(),I(5,"li",10),ne(6,"span",11),I(7,"span"),he(8,"Qu\u1EA3n L\xFD Ng\u01B0\u1EDDi D\xF9ng"),K()(),I(9,"li",10),ne(10,"span",12),I(11,"span"),he(12,"Danh S\xE1ch \u0110\u01A1n Y\xEAu C\xE2\u0300u"),K()(),I(13,"li",10),ne(14,"span",13),I(15,"span"),he(16,"Danh S\xE1ch C\u1EEDa H\xE0ng"),K()(),I(17,"li",10),ne(18,"span",14),I(19,"span"),he(20,"Danh S\xE1ch Loa\u0323i Thi\xEA\u0301t Bi\u0323"),K()(),bi()),t&2&&(oe(5),G("routerLink",F(8,nd))("routerLinkActiveOptions",F(9,_t)),oe(4),G("routerLink",F(10,id))("routerLinkActiveOptions",F(11,_t)),oe(4),G("routerLink",F(12,sd))("routerLinkActiveOptions",F(13,_t)),oe(4),G("routerLink",F(14,rd))("routerLinkActiveOptions",F(15,_t)))}function dd(t,e){if(t&1&&(Ii(0),I(1,"li",15),ne(2,"span",9),I(3,"span"),he(4,"Th\xF4ng K\xEA"),K()(),I(5,"li",10),ne(6,"span",16),I(7,"span"),he(8,"Danh S\xE1ch \u0110\u01A1n Thu\xEA"),K()(),I(9,"li",10),ne(10,"span",17),I(11,"span"),he(12,"Danh S\xE1ch Th\xF4ng B\xE1o"),K()(),I(13,"li",10),ne(14,"span",13),I(15,"span"),he(16,"C\u1EEDa H\xE0ng"),K()(),I(17,"li",10),ne(18,"span",18),I(19,"span"),he(20,"Qua\u0309n Ly\u0301 Khuy\xEA\u0301n Ma\u0303i"),K()(),bi()),t&2){let n=To();oe(),G("routerLink",F(10,od))("routerLinkActiveOptions",F(11,_t)),oe(4),G("routerLink",F(12,ad))("routerLinkActiveOptions",F(13,Ki)),oe(4),G("routerLink",F(14,cd))("routerLinkActiveOptions",F(15,Ki)),oe(4),G("routerLink",bo(16,ld,n.shopId))("routerLinkActiveOptions",F(18,_t)),oe(4),G("routerLink",F(19,ud))("routerLinkActiveOptions",F(20,Ki))}}var Yi=(()=>{let e=class e{onToggleSidebar(i){this.isSidebarCollapsed=i,console.log("Sidebar status: ",this.isSidebarCollapsed?"Collapsed":"Expanded")}onAvatarClick(){console.log("Avatar clicked!"),console.log(this.userRole)}constructor(i,s){this.userProfileService=i,this.router=s,this.isSidebarCollapsed=!1,this.USERROLE=Ie,this.notificationCount=5,this.isShopSlected=!1,this.isRenterSlected=!1,this.userRole=Ie.LESSOR,this.router.events.subscribe(()=>{this.checkActiveShopRoute(),this.checkRenterRoute()})}ngOnInit(){let i=this.userProfileService.roleCurrentUser;typeof i=="string"&&Object.values(Ie).includes(i)?this.userRole=i:Array.isArray(i)&&i.length>0?this.userRole=i[0]:console.warn("Invalid or undefined user role"),this.shopId=this.userProfileService.rentalshopId}hasLessorRole(){let i=this.userProfileService.roleCurrentUser;return Array.isArray(i)?i.includes(Ie.LESSOR):i===Ie.LESSOR}checkActiveShopRoute(){let i=this.router.url;this.isShopSlected=i.startsWith("/lessor/shop")}checkRenterRoute(){let i=this.router.url;this.isRenterSlected=i.startsWith("/lessor/order")}};e.\u0275fac=function(s){return new(s||e)(st(ua),st(de))},e.\u0275cmp=yn({type:e,selectors:[["app-layout-dashboard"]],decls:12,vars:8,consts:[[3,"toggleSidebar","avatarClick","isCollapsed","notificationCount"],[1,"main-layout"],["nzCollapsible","","nzTheme","light",2,"width","250px","min-width","100px",3,"nzCollapsedChange","nzCollapsed","nzTrigger"],["nz-menu","","nzTheme","light","nzMode","inline",1,"mt-10"],["nz-menu-item","",3,"routerLink"],["nz-icon","","nzType","home","nzTheme","outline"],[4,"ngIf"],[2,"min-height","calc(100vh - 65px)"],["nz-menu-item",""],["nz-icon","","nzType","bar-chart","nzTheme","outline"],["nz-menu-item","","routerLinkActive","ant-menu-item-selected",3,"routerLink","routerLinkActiveOptions"],["nz-icon","","nzType","user","nzTheme","outline"],["nz-icon","","nzType","solution","nzTheme","outline"],["nz-icon","","nzType","shop","nzTheme","outline"],["nz-icon","","nzType","apartment","nzTheme","outline"],["nz-menu-item","","nz-menu-item","","routerLinkActive","ant-menu-item-selected",3,"routerLink","routerLinkActiveOptions"],["nz-icon","","nzType","usergroup-add","nzTheme","outline"],["nz-icon","","nzType","bell","nzTheme","outline"],["nz-icon","","nzType","profile","nzTheme","outline"]],template:function(s,r){s&1&&(I(0,"app-navbar-headear",0),Eo("toggleSidebar",function(a){return r.onToggleSidebar(a)})("avatarClick",function(){return r.onAvatarClick()}),K(),I(1,"nz-layout",1)(2,"nz-sider",2),Io("nzCollapsedChange",function(a){return So(r.isSidebarCollapsed,a)||(r.isSidebarCollapsed=a),a}),I(3,"ul",3)(4,"li",4),ne(5,"span",5),I(6,"span"),he(7,"Trang Chu\u0309"),K()(),wo(8,hd,21,16,"ng-container",6)(9,dd,21,21,"ng-container",6),K()(),I(10,"nz-content",7),ne(11,"router-outlet"),K()()),s&2&&(G("isCollapsed",r.isSidebarCollapsed)("notificationCount",r.notificationCount),oe(2),Co("nzCollapsed",r.isSidebarCollapsed),G("nzTrigger",null),oe(2),G("routerLink",F(7,td)),oe(4),G("ngIf",r.userRole===r.USERROLE.ADMIN),oe(),G("ngIf",r.hasLessorRole()))},dependencies:[Oo,aa,ra,oa,ta,ea,sa,ia,Ma,En,Ho,Go],styles:[`.trigger{font-size:18px;line-height:64px;padding:0 24px;cursor:pointer;transition:color .3s}.trigger:hover{color:#1890ff}nz-content{margin:0 16px}.inner-content{padding:24px;background:#fff;min-height:360px}
`],encapsulation:2});let t=e;return t})();var $n=(t,e)=>{let n=te(de),i=te(Oe),s=e.url;return i.checkUserLogin$(t,s)};var gc=(t,e)=>{let n=te(Oe),i=te(de);return console.log("line 9",t,e.url),n.isAuthenticated$.pipe(mn(1),O(s=>s&&!e.url.includes(Pe.ChangePassword.label)?(i.navigate(["/common/home"]),!1):!0))};var fd=[{path:"",pathMatch:"full",redirectTo:"/common/home"},{path:"base",component:ca},{path:"admin",canActivate:[$n],component:Yi,data:{expectedRole:[Ie.ADMIN]},loadChildren:()=>import("./chunk-AFRHS6X7.js").then(t=>t.AdminModule)},{path:"common",component:lc,loadChildren:()=>import("./chunk-DJXAGZUV.js").then(t=>t.CommonFeatureModule)},{path:"auth",canActivate:[gc],loadChildren:()=>import("./chunk-7HABTXFM.js").then(t=>t.AuthModule)},{path:"portal",canActivate:[$n],data:{expectedRole:[Ie.RENTER]},loadChildren:()=>import("./chunk-ZB7UUBDQ.js").then(t=>t.RegisterLessorModule)},{path:"lessor",canActivate:[$n],component:Yi,data:{expectedRole:[Ie.LESSOR]},loadChildren:()=>import("./chunk-J6A76H5C.js").then(t=>t.LessorModule)},{path:"**",component:hc}],yc=(()=>{let e=class e{};e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=Ce({type:e}),e.\u0275inj=Te({imports:[Ni.forRoot(fd),Ni]});let t=e;return t})();var wc=(()=>{let e=class e{constructor(i,s){this.loadingService=i,this.route=s,this.loading$=this.loadingService.status$}ngOnInit(){}};e.\u0275fac=function(s){return new(s||e)(st(pt),st(qo))},e.\u0275cmp=yn({type:e,selectors:[["app-root"]],decls:3,vars:4,consts:[["nzTip","\u0110ang t\u1EA3i...",3,"nzSize","nzSpinning"]],template:function(s,r){s&1&&(I(0,"nz-spin",0),Ao(1,"async"),ne(2,"router-outlet"),K()),s&2&&G("nzSize","large")("nzSpinning",Ro(1,2,r.loading$)==="loading")},dependencies:[Da,En,xo],changeDetection:0});let t=e;return t})();var pd=[Zo,Xo,Yo,Qo],Ec=(()=>{let e=class e{};e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=Ce({type:e}),e.\u0275inj=Te({providers:[{provide:Jo,useValue:pd}],imports:[Oi,Oi]});let t=e;return t})();var _d="@",md=(()=>{let e=class e{constructor(i,s,r,o,a){this.doc=i,this.delegate=s,this.zone=r,this.animationType=o,this.moduleImpl=a,this._rendererFactoryPromise=null,this.scheduler=te(go,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){return(this.moduleImpl??import("./chunk-MEQ22VHZ.js")).catch(s=>{throw new ho(5300,!1)}).then(({\u0275createEngine:s,\u0275AnimationRendererFactory:r})=>{this._engine=s(this.animationType,this.doc,this.scheduler);let o=new r(this.delegate,this._engine,this.zone);return this.delegate=o,o})}createRenderer(i,s){let r=this.delegate.createRenderer(i,s);if(r.\u0275type===0)return r;typeof r.throwOnSyntheticProps=="boolean"&&(r.throwOnSyntheticProps=!1);let o=new Qi(r);return s?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(a=>{let c=a.createRenderer(i,s);o.use(c)}).catch(a=>{o.use(r)}),o}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};e.\u0275fac=function(s){mo()},e.\u0275prov=Y({token:e,factory:e.\u0275fac});let t=e;return t})(),Qi=class{constructor(e){this.delegate=e,this.replay=[],this.\u0275type=1}use(e){if(this.delegate=e,this.replay!==null){for(let n of this.replay)n(e);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(e,n){return this.delegate.createElement(e,n)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}get destroyNode(){return this.delegate.destroyNode}appendChild(e,n){this.delegate.appendChild(e,n)}insertBefore(e,n,i,s){this.delegate.insertBefore(e,n,i,s)}removeChild(e,n,i){this.delegate.removeChild(e,n,i)}selectRootElement(e,n){return this.delegate.selectRootElement(e,n)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,n,i,s){this.delegate.setAttribute(e,n,i,s)}removeAttribute(e,n,i){this.delegate.removeAttribute(e,n,i)}addClass(e,n){this.delegate.addClass(e,n)}removeClass(e,n){this.delegate.removeClass(e,n)}setStyle(e,n,i,s){this.delegate.setStyle(e,n,i,s)}removeStyle(e,n,i){this.delegate.removeStyle(e,n,i)}setProperty(e,n,i){this.shouldReplay(n)&&this.replay.push(s=>s.setProperty(e,n,i)),this.delegate.setProperty(e,n,i)}setValue(e,n){this.delegate.setValue(e,n)}listen(e,n,i){return this.shouldReplay(n)&&this.replay.push(s=>s.listen(e,n,i)),this.delegate.listen(e,n,i)}shouldReplay(e){return this.replay!==null&&e.startsWith(_d)}};function Tc(t="animations"){return vo("NgAsyncAnimations"),ue([{provide:yo,useFactory:(e,n,i)=>new md(e,n,i,t),deps:[No,Wo,Se]},{provide:_o,useValue:t==="noop"?"NoopAnimations":"BrowserAnimations"}])}var Ac="@ngrx/router-store/request",gy=Q(Ac,ie()),Rc="@ngrx/router-store/navigation",yy=Q(Rc,ie()),kc="@ngrx/router-store/cancel",vy=Q(kc,ie()),Nc="@ngrx/router-store/error",wy=Q(Nc,ie()),Pc="@ngrx/router-store/navigated",Ey=Q(Pc,ie());var jn=class{serialize(e){return{root:this.serializeRoute(e.root),url:e.url}}serializeRoute(e){let n=e.children.map(i=>this.serializeRoute(i));return{params:e.params,data:e.data,url:e.url,outlet:e.outlet,title:e.title,routeConfig:e.routeConfig?{path:e.routeConfig.path,pathMatch:e.routeConfig.pathMatch,redirectTo:e.routeConfig.redirectTo,outlet:e.routeConfig.outlet,title:typeof e.routeConfig.title=="string"?e.routeConfig.title:void 0}:null,queryParams:e.queryParams,fragment:e.fragment,firstChild:n[0],children:n}}},Xi=function(t){return t[t.PreActivation=1]="PreActivation",t[t.PostActivation=2]="PostActivation",t}(Xi||{}),gd="router",Cc=new re("@ngrx/router-store Internal Configuration"),Oc=new re("@ngrx/router-store Configuration");function yd(t){return P({stateKey:gd,serializer:jn,navigationActionTiming:Xi.PreActivation},t)}var zn=class{serialize(e){return{root:this.serializeRoute(e.root),url:e.url}}serializeRoute(e){let n=e.children.map(i=>this.serializeRoute(i));return{params:e.params,paramMap:e.paramMap,data:e.data,url:e.url,outlet:e.outlet,title:e.title,routeConfig:e.routeConfig?{component:e.routeConfig.component,path:e.routeConfig.path,pathMatch:e.routeConfig.pathMatch,redirectTo:e.routeConfig.redirectTo,outlet:e.routeConfig.outlet,title:e.routeConfig.title}:null,queryParams:e.queryParams,queryParamMap:e.queryParamMap,fragment:e.fragment,component:e.routeConfig?e.routeConfig.component:void 0,root:void 0,parent:void 0,firstChild:n[0],pathFromRoot:void 0,children:n}}},Vn=class{},xe=function(t){return t[t.NONE=1]="NONE",t[t.ROUTER=2]="ROUTER",t[t.STORE=3]="STORE",t}(xe||{}),Sc=(()=>{let e=class e{constructor(i,s,r,o,a,c){this.store=i,this.router=s,this.serializer=r,this.errorHandler=o,this.config=a,this.activeRuntimeChecks=c,this.lastEvent=null,this.routerState=null,this.trigger=xe.NONE,this.stateKey=this.config.stateKey,!va()&&wn()&&(c?.strictActionSerializability||c?.strictStateSerializability)&&this.serializer instanceof zn&&console.warn("@ngrx/router-store: The serializability runtime checks cannot be enabled with the FullRouterStateSerializer. The FullRouterStateSerializer has an unserializable router state and actions that are not serializable. To use the serializability runtime checks either use the MinimalRouterStateSerializer or implement a custom router state serializer."),this.setUpStoreStateListener(),this.setUpRouterEventsListener()}setUpStoreStateListener(){this.store.pipe(ya(this.stateKey),Ot(this.store)).subscribe(([i,s])=>{this.navigateIfNeeded(i,s)})}navigateIfNeeded(i,s){if(!i||!i.state||this.trigger===xe.ROUTER||this.lastEvent instanceof Ai)return;let r=i.state.url;vd(this.router.url,r)||(this.storeState=s,this.trigger=xe.STORE,this.router.navigateByUrl(r).catch(o=>{this.errorHandler.handleError(o)}))}setUpRouterEventsListener(){let i=this.config.navigationActionTiming===Xi.PostActivation,s;this.router.events.pipe(Ot(this.store)).subscribe(([r,o])=>{this.lastEvent=r,r instanceof Ai?(this.routerState=this.serializer.serialize(this.router.routerState.snapshot),this.trigger!==xe.STORE&&(this.storeState=o,this.dispatchRouterRequest(r))):r instanceof ki?(s=r,!i&&this.trigger!==xe.STORE&&this.dispatchRouterNavigation(r)):r instanceof Vo?(this.dispatchRouterCancel(r),this.reset()):r instanceof Ri?(this.dispatchRouterError(r),this.reset()):r instanceof zo&&(this.trigger!==xe.STORE&&(i&&this.dispatchRouterNavigation(s),this.dispatchRouterNavigated(r)),this.reset())})}dispatchRouterRequest(i){this.dispatchRouterAction(Ac,{event:i})}dispatchRouterNavigation(i){let s=this.serializer.serialize(i.state);this.dispatchRouterAction(Rc,{routerState:s,event:new ki(i.id,i.url,i.urlAfterRedirects,s)})}dispatchRouterCancel(i){this.dispatchRouterAction(kc,{storeState:this.storeState,event:i})}dispatchRouterError(i){this.dispatchRouterAction(Nc,{storeState:this.storeState,event:new Ri(i.id,i.url,`${i}`)})}dispatchRouterNavigated(i){let s=this.serializer.serialize(this.router.routerState.snapshot);this.dispatchRouterAction(Pc,{event:i,routerState:s})}dispatchRouterAction(i,s){this.trigger=xe.ROUTER;try{this.store.dispatch({type:i,payload:q(P({routerState:this.routerState},s),{event:this.config.routerState===0?s.event:{id:s.event.id,url:s.event.url,urlAfterRedirects:s.event.urlAfterRedirects}})})}finally{this.trigger=xe.NONE}}reset(){this.trigger=xe.NONE,this.storeState=null,this.routerState=null}};e.\u0275fac=function(s){return new(s||e)(v(Sn),v(de),v(Vn),v(vn),v(Oc),v(fa))},e.\u0275prov=Y({token:e,factory:e.\u0275fac});let t=e;return t})();function vd(t,e){return Ic(t)===Ic(e)}function Ic(t){return t?.length>0&&t[t.length-1]==="/"?t.substring(0,t.length-1):t}function wd(t={}){return ue([{provide:Cc,useValue:t},{provide:Oc,useFactory:yd,deps:[Cc]},{provide:Vn,useClass:t.serializer?t.serializer:t.routerState===0?zn:jn},{provide:fo,multi:!0,useFactory(){return()=>te(Sc)}},Sc])}var xc=(()=>{let e=class e{static forRoot(i={}){return{ngModule:e,providers:[wd(i)]}}};e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=Ce({type:e}),e.\u0275inj=Te({});let t=e;return t})();var $t="PERFORM_ACTION",Ed="REFRESH",Bc="RESET",Wc="ROLLBACK",$c="COMMIT",jc="SWEEP",zc="TOGGLE_ACTION",Td="SET_ACTIONS_ACTIVE",Vc="JUMP_TO_STATE",qc="JUMP_TO_ACTION",us="IMPORT_STATE",Hc="LOCK_CHANGES",Gc="PAUSE_RECORDING",mt=class{constructor(e,n){if(this.action=e,this.timestamp=n,this.type=$t,typeof e.type>"u")throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?')}},Zi=class{constructor(){this.type=Ed}},Ji=class{constructor(e){this.timestamp=e,this.type=Bc}},es=class{constructor(e){this.timestamp=e,this.type=Wc}},ts=class{constructor(e){this.timestamp=e,this.type=$c}},ns=class{constructor(){this.type=jc}},is=class{constructor(e){this.id=e,this.type=zc}};var ss=class{constructor(e){this.index=e,this.type=Vc}},rs=class{constructor(e){this.actionId=e,this.type=qc}},os=class{constructor(e){this.nextLiftedState=e,this.type=us}},as=class{constructor(e){this.status=e,this.type=Hc}},cs=class{constructor(e){this.status=e,this.type=Gc}};var Kn=new re("@ngrx/store-devtools Options"),Dc=new re("@ngrx/store-devtools Initial Config");function Kc(){return null}var Cd="NgRx Store DevTools";function Sd(t){let e={maxAge:!1,monitor:Kc,actionSanitizer:void 0,stateSanitizer:void 0,name:Cd,serialize:!1,logOnly:!1,autoPause:!1,trace:!1,traceLimit:75,features:{pause:!0,lock:!0,persist:!0,export:!0,import:"custom",jump:!0,skip:!0,reorder:!0,dispatch:!0,test:!0},connectInZone:!1},n=typeof t=="function"?t():t,i=n.logOnly?{pause:!0,export:!0,test:!0}:!1,s=n.features||i||e.features;s.import===!0&&(s.import="custom");let r=Object.assign({},e,{features:s},n);if(r.maxAge&&r.maxAge<2)throw new Error(`Devtools 'maxAge' cannot be less than 2, got ${r.maxAge}`);return r}function Mc(t,e){return t.filter(n=>e.indexOf(n)<0)}function Yc(t){let{computedStates:e,currentStateIndex:n}=t;if(n>=e.length){let{state:s}=e[e.length-1];return s}let{state:i}=e[n];return i}function Wt(t){return new mt(t,+Date.now())}function Id(t,e){return Object.keys(e).reduce((n,i)=>{let s=Number(i);return n[s]=Qc(t,e[s],s),n},{})}function Qc(t,e,n){return q(P({},e),{action:t(e.action,n)})}function bd(t,e){return e.map((n,i)=>({state:Xc(t,n.state,i),error:n.error}))}function Xc(t,e,n){return t(e,n)}function Zc(t){return t.predicate||t.actionsSafelist||t.actionsBlocklist}function Ad(t,e,n,i){let s=[],r={},o=[];return t.stagedActionIds.forEach((a,c)=>{let l=t.actionsById[a];l&&(c&&hs(t.computedStates[c],l,e,n,i)||(r[a]=l,s.push(a),o.push(t.computedStates[c])))}),q(P({},t),{stagedActionIds:s,actionsById:r,computedStates:o})}function hs(t,e,n,i,s){let r=n&&!n(t,e.action),o=i&&!e.action.type.match(i.map(c=>Lc(c)).join("|")),a=s&&e.action.type.match(s.map(c=>Lc(c)).join("|"));return r||o||a}function Lc(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Jc(t){return{ngZone:t?te(Se):null,connectInZone:t}}var Yn=(()=>{let e=class e extends Cn{};e.\u0275fac=(()=>{let i;return function(r){return(i||(i=po(e)))(r||e)}})(),e.\u0275prov=Y({token:e,factory:e.\u0275fac});let t=e;return t})(),qn={START:"START",DISPATCH:"DISPATCH",STOP:"STOP",ACTION:"ACTION"},ls=new re("@ngrx/store-devtools Redux Devtools Extension"),el=(()=>{let e=class e{constructor(i,s,r){this.config=s,this.dispatcher=r,this.zoneConfig=Jc(this.config.connectInZone),this.devtoolsExtension=i,this.createActionStreams()}notify(i,s){if(this.devtoolsExtension)if(i.type===$t){if(s.isLocked||s.isPaused)return;let r=Yc(s);if(Zc(this.config)&&hs(r,i,this.config.predicate,this.config.actionsSafelist,this.config.actionsBlocklist))return;let o=this.config.stateSanitizer?Xc(this.config.stateSanitizer,r,s.currentStateIndex):r,a=this.config.actionSanitizer?Qc(this.config.actionSanitizer,i,s.nextActionId):i;this.sendToReduxDevtools(()=>this.extensionConnection.send(a,o))}else{let r=q(P({},s),{stagedActionIds:s.stagedActionIds,actionsById:this.config.actionSanitizer?Id(this.config.actionSanitizer,s.actionsById):s.actionsById,computedStates:this.config.stateSanitizer?bd(this.config.stateSanitizer,s.computedStates):s.computedStates});this.sendToReduxDevtools(()=>this.devtoolsExtension.send(null,r,this.getExtensionConfig(this.config)))}}createChangesObservable(){return this.devtoolsExtension?new Ci(i=>{let s=this.zoneConfig.connectInZone?this.zoneConfig.ngZone.runOutsideAngular(()=>this.devtoolsExtension.connect(this.getExtensionConfig(this.config))):this.devtoolsExtension.connect(this.getExtensionConfig(this.config));return this.extensionConnection=s,s.init(),s.subscribe(r=>i.next(r)),s.unsubscribe}):eo}createActionStreams(){let i=this.createChangesObservable().pipe(lo()),s=i.pipe(nt(h=>h.type===qn.START)),r=i.pipe(nt(h=>h.type===qn.STOP)),o=i.pipe(nt(h=>h.type===qn.DISPATCH),O(h=>this.unwrapAction(h.payload)),ro(h=>h.type===us?this.dispatcher.pipe(nt(u=>u.type===Dt),no(1e3),oo(1e3),O(()=>h),B(()=>U(h)),mn(1)):U(h))),c=i.pipe(nt(h=>h.type===qn.ACTION),O(h=>this.unwrapAction(h.payload))).pipe(gn(r)),l=o.pipe(gn(r));this.start$=s.pipe(gn(r)),this.actions$=this.start$.pipe(H(()=>c)),this.liftedActions$=this.start$.pipe(H(()=>l))}unwrapAction(i){return typeof i=="string"?(0,eval)(`(${i})`):i}getExtensionConfig(i){let s={name:i.name,features:i.features,serialize:i.serialize,autoPause:i.autoPause??!1,trace:i.trace??!1,traceLimit:i.traceLimit??75};return i.maxAge!==!1&&(s.maxAge=i.maxAge),s}sendToReduxDevtools(i){try{i()}catch(s){console.warn("@ngrx/store-devtools: something went wrong inside the redux devtools",s)}}};e.\u0275fac=function(s){return new(s||e)(v(ls),v(Kn),v(Yn))},e.\u0275prov=Y({token:e,factory:e.\u0275fac});let t=e;return t})(),Gn={type:xt},Rd="@ngrx/store-devtools/recompute",kd={type:Rd};function tl(t,e,n,i,s){if(i)return{state:n,error:"Interrupted by an error up the chain"};let r=n,o;try{r=t(n,e)}catch(a){o=a.toString(),s.handleError(a)}return{state:r,error:o}}function Hn(t,e,n,i,s,r,o,a,c){if(e>=t.length&&t.length===r.length)return t;let l=t.slice(0,e),h=r.length-(c?1:0);for(let u=e;u<h;u++){let d=r[u],_=s[d].action,f=l[u-1],m=f?f.state:i,w=f?f.error:void 0,z=o.indexOf(d)>-1?f:tl(n,_,m,w,a);l.push(z)}return c&&l.push(t[t.length-1]),l}function Nd(t,e){return{monitorState:e(void 0,{}),nextActionId:1,actionsById:{0:Wt(Gn)},stagedActionIds:[0],skippedActionIds:[],committedState:t,currentStateIndex:0,computedStates:[],isLocked:!1,isPaused:!1}}function Pd(t,e,n,i,s={}){return r=>(o,a)=>{let{monitorState:c,actionsById:l,nextActionId:h,stagedActionIds:u,skippedActionIds:d,committedState:_,currentStateIndex:f,computedStates:m,isLocked:w,isPaused:N}=o||e;o||(l=Object.create(l));function z(R){let S=R,Ee=u.slice(1,S+1);for(let ee=0;ee<Ee.length;ee++)if(m[ee+1].error){S=ee,Ee=u.slice(1,S+1);break}else delete l[Ee[ee]];d=d.filter(ee=>Ee.indexOf(ee)===-1),u=[0,...u.slice(S+1)],_=m[S].state,m=m.slice(S),f=f>S?f-S:0}function V(){l={0:Wt(Gn)},h=1,u=[0],d=[],_=m[f].state,f=0,m=[]}let y=0;switch(a.type){case Hc:{w=a.status,y=1/0;break}case Gc:{N=a.status,N?(u=[...u,h],l[h]=new mt({type:"@ngrx/devtools/pause"},+Date.now()),h++,y=u.length-1,m=m.concat(m[m.length-1]),f===u.length-2&&f++,y=1/0):V();break}case Bc:{l={0:Wt(Gn)},h=1,u=[0],d=[],_=t,f=0,m=[];break}case $c:{V();break}case Wc:{l={0:Wt(Gn)},h=1,u=[0],d=[],f=0,m=[];break}case zc:{let{id:R}=a;d.indexOf(R)===-1?d=[R,...d]:d=d.filter(Ee=>Ee!==R),y=u.indexOf(R);break}case Td:{let{start:R,end:S,active:Ee}=a,ee=[];for(let Ti=R;Ti<S;Ti++)ee.push(Ti);Ee?d=Mc(d,ee):d=[...d,...ee],y=u.indexOf(R);break}case Vc:{f=a.index,y=1/0;break}case qc:{let R=u.indexOf(a.actionId);R!==-1&&(f=R),y=1/0;break}case jc:{u=Mc(u,d),d=[],f=Math.min(f,u.length-1);break}case $t:{if(w)return o||e;if(N||o&&hs(o.computedStates[f],a,s.predicate,s.actionsSafelist,s.actionsBlocklist)){let S=m[m.length-1];m=[...m.slice(0,-1),tl(r,a.action,S.state,S.error,n)],y=1/0;break}s.maxAge&&u.length===s.maxAge&&z(1),f===u.length-1&&f++;let R=h++;l[R]=a,u=[...u,R],y=u.length-1;break}case us:{({monitorState:c,actionsById:l,nextActionId:h,stagedActionIds:u,skippedActionIds:d,committedState:_,currentStateIndex:f,computedStates:m,isLocked:w,isPaused:N}=a.nextLiftedState);break}case xt:{y=0,s.maxAge&&u.length>s.maxAge&&(m=Hn(m,y,r,_,l,u,d,n,N),z(u.length-s.maxAge),y=1/0);break}case Dt:{if(m.filter(S=>S.error).length>0)y=0,s.maxAge&&u.length>s.maxAge&&(m=Hn(m,y,r,_,l,u,d,n,N),z(u.length-s.maxAge),y=1/0);else{if(!N&&!w){f===u.length-1&&f++;let S=h++;l[S]=new mt(a,+Date.now()),u=[...u,S],y=u.length-1,m=Hn(m,y,r,_,l,u,d,n,N)}m=m.map(S=>q(P({},S),{state:r(S.state,kd)})),f=u.length-1,s.maxAge&&u.length>s.maxAge&&z(u.length-s.maxAge),y=1/0}break}default:{y=1/0;break}}return m=Hn(m,y,r,_,l,u,d,n,N),c=i(c,a),{monitorState:c,actionsById:l,nextActionId:h,stagedActionIds:u,skippedActionIds:d,committedState:_,currentStateIndex:f,computedStates:m,isLocked:w,isPaused:N}}}var Fc=(()=>{let e=class e{constructor(i,s,r,o,a,c,l,h){let u=Nd(l,h.monitor),d=Pd(l,u,c,h.monitor,h),_=Si(Si(s.asObservable().pipe(uo(1)),o.actions$).pipe(O(Wt)),i,o.liftedActions$).pipe(to(Jr)),f=r.pipe(O(d)),m=Jc(h.connectInZone),w=new Zr(1);this.liftedStateSubscription=_.pipe(Ot(f),Uc(m),co(({state:V},[y,R])=>{let S=R(V,y);return y.type!==$t&&Zc(h)&&(S=Ad(S,h.predicate,h.actionsSafelist,h.actionsBlocklist)),o.notify(y,S),{state:S,action:y}},{state:u,action:null})).subscribe(({state:V,action:y})=>{if(w.next(V),y.type===$t){let R=y.action;a.next(R)}}),this.extensionStartSubscription=o.start$.pipe(Uc(m)).subscribe(()=>{this.refresh()});let N=w.asObservable(),z=N.pipe(O(Yc));Object.defineProperty(z,"state",{value:ha(z,{manualCleanup:!0,requireSync:!0})}),this.dispatcher=i,this.liftedState=N,this.state=z}ngOnDestroy(){this.liftedStateSubscription.unsubscribe(),this.extensionStartSubscription.unsubscribe()}dispatch(i){this.dispatcher.next(i)}next(i){this.dispatcher.next(i)}error(i){}complete(){}performAction(i){this.dispatch(new mt(i,+Date.now()))}refresh(){this.dispatch(new Zi)}reset(){this.dispatch(new Ji(+Date.now()))}rollback(){this.dispatch(new es(+Date.now()))}commit(){this.dispatch(new ts(+Date.now()))}sweep(){this.dispatch(new ns)}toggleAction(i){this.dispatch(new is(i))}jumpToAction(i){this.dispatch(new rs(i))}jumpToState(i){this.dispatch(new ss(i))}importState(i){this.dispatch(new os(i))}lockChanges(i){this.dispatch(new as(i))}pauseRecording(i){this.dispatch(new cs(i))}};e.\u0275fac=function(s){return new(s||e)(v(Yn),v(Cn),v(pa),v(el),v(ma),v(vn),v(da),v(Kn))},e.\u0275prov=Y({token:e,factory:e.\u0275fac});let t=e;return t})();function Uc({ngZone:t,connectInZone:e}){return n=>e?new Ci(i=>n.subscribe({next:s=>t.run(()=>i.next(s)),error:s=>t.run(()=>i.error(s)),complete:()=>t.run(()=>i.complete())})):n}var Od=new re("@ngrx/store-devtools Is Devtools Extension or Monitor Present");function xd(t,e){return!!t||e.monitor!==Kc}function Dd(){let t="__REDUX_DEVTOOLS_EXTENSION__";return typeof window=="object"&&typeof window[t]<"u"?window[t]:null}function Md(t={}){return ue([el,Yn,Fc,{provide:Dc,useValue:t},{provide:Od,deps:[ls,Kn],useFactory:xd},{provide:ls,useFactory:Dd},{provide:Kn,deps:[Dc],useFactory:Sd},{provide:ga,deps:[Fc],useFactory:Ld},{provide:_a,useExisting:Yn}])}function Ld(t){return t.state}var nl=(()=>{let e=class e{static instrument(i={}){return{ngModule:e,providers:[Md(i)]}}};e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=Ce({type:e}),e.\u0275inj=Te({});let t=e;return t})();var il=(()=>{let e=class e{constructor(i,s,r,o,a,c,l,h){this.action$=i,this.authService=s,this.router=r,this.store=o,this.loadingSerivce=a,this.storageService=c,this.messageNZ=l,this.toastMT=h,this.loginProcess$=x(()=>this.action$.pipe(D(Ta),L(()=>this.loadingSerivce.setLoading()),H(({data:u})=>this.authService.login(u).pipe(O(d=>xi({accessToken:d.data.accessToken,refreshToken:d.data.refreshToken})),B(d=>{console.log("error",d);let _=Gi(d),f=d.status||d.statusCode;return U(In({error:_,statusCode:f}))})))),{dispatch:!0}),this.loginExternalProcess$=x(()=>this.action$.pipe(D(Ca),L(()=>this.loadingSerivce.setLoading()),H(({data:u})=>this.authService.loginwithGoogle(u).pipe(O(d=>Di({accessToken:d.data.accessToken,refreshToken:d.data.refreshToken})),B(d=>(console.log("error",d),U(Mi({error:d}))))))),{dispatch:!0}),this.forgotPasswordProcess$=x(()=>this.action$.pipe(D(Sa),L(()=>this.loadingSerivce.setLoading()),H(({data:u})=>this.authService.forgotPassWord(u).pipe(O(d=>Li({email:u.email})),B(d=>{console.log("error",d);let _=Gi(d),f=d.status||d.statusCode;return U(Fi({error:_,statusCode:f}))})))),{dispatch:!0}),this.registerProcess$=x(()=>this.action$.pipe(D(Ra),L(()=>this.loadingSerivce.setLoading()),io(({data:u})=>this.authService.register(u).pipe(O(d=>bn({message:d.message})),B(d=>U(An({error:"\u0110\xE3 x\u1EA3y ra l\u1ED7i"})))))),{dispatch:!0}),this.resetPassword$=x(()=>this.action$.pipe(D(Ia),L(()=>this.loadingSerivce.setLoading()),H(({data:u})=>this.authService.resetPassword(u).pipe(O(d=>{if(d.statusCode!=Pi.OK)throw Error;return Ui()}),B(d=>{let _=d.status,f=d.errorList.map(m=>m.errorMessage);return U(Bi({error:f,statusCode:_}))})))),{dispatch:!0}),this.verifyEmailProcess$=x(()=>this.action$.pipe(D(Na),L(()=>{this.loadingSerivce.setLoading()}),H(({email:u,username:d})=>this.authService.verifyEmail({email:u,userName:d}).pipe(O(({statusCode:_})=>Wi({statusCode:_})),B(_=>{let f=_.errorList.map(m=>m.errorMessage);return U(Lt({error:f}))})))),{dispatch:!0}),this.confirmVerifyEmailProcess$=x(()=>this.action$.pipe(D(Pa),L(()=>{this.loadingSerivce.setLoading()}),H(({data:u,dataRegister:d})=>this.authService.confirmVerifyEmail(u).pipe(H(({statusCode:_})=>_===Pi.OK?this.authService.register(d).pipe(O(f=>bn({message:f.message})),B(f=>U(An({error:"\u0110\xE3 x\u1EA3y ra l\u1ED7i trong khi t\u1EA1o t\xE0i kho\u1EA3n"})))):U(Lt({error:"M\xE3 OTP kh\xF4ng h\u1EE3p l\u1EC7!"}))),B(_=>U(Lt({error:"C\xF3 l\u1ED7i x\u1EA3y ra vui l\xF2ng th\u1EED l\u1EA1i"})))))),{dispatch:!0}),this.loginSuccess$=x(()=>this.action$.pipe(D(xi,Di),L(u=>{u?(this.loadingSerivce.setOtherLoading("loaded"),this.authService.startSession(u.accessToken,u.refreshToken),this.messageNZ.success("\u0110\u0103ng nh\u1EADp th\xE0nh c\xF4ng")):(this.loadingSerivce.setOtherLoading("error"),B(d=>{let _=d.errorList.map(f=>f.errorMessage);return U(In({error:_,statusCode:0}))}))})),{dispatch:!1}),this.forogotPassword_success$=x(()=>this.action$.pipe(D(Li),L(({email:u})=>{let d=new Date;this.loadingSerivce.setOtherLoading("loaded"),this.storageService.setSession(Ko.EMAIL,u)})),{dispatch:!1}),this.checkOtpCodeSendToEmail_success$=x(()=>this.action$.pipe(D(ba),L(()=>{this.loadingSerivce.setOtherLoading("loaded"),this.messageNZ.create("success","Vui l\xF2ng nh\u1EADp m\u1EADt kh\u1EA9u m\u1EDBi!"),this.router.navigate(["auth/reset-password"])})),{dispatch:!1}),this.resetPassword_success$=x(()=>this.action$.pipe(D(Ui),L(()=>{this.loadingSerivce.setOtherLoading("loaded"),this.messageNZ.create("success","Ba\u0323n \u0111a\u0303 c\xE2\u0323p nh\xE2\u0323t m\xE2\u0323t kh\xE2\u0309u m\u01A1\u0301i tha\u0300nh c\xF4ng. Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i v\xE0o h\u1EC7 th\u1ED1ng!"),this.router.navigate(["auth/login"])})),{dispatch:!1}),this.register_success$=x(()=>this.action$.pipe(D(bn),ao(5e3),L(()=>{this.messageNZ.create("success","B\u1EA1n \u0111\xE3 t\u1EA1o t\xE0i kho\u1EA3n th\xE0nh c\xF4ng!"),this.loadingSerivce.setOtherLoading("loaded"),this.router.navigateByUrl("/auth/login")})),{dispatch:!1}),this.logout$=x(()=>this.action$.pipe(D(ka),L(()=>{this.authService.logout()})),{dispatch:!1}),this.verifyEmail_success$=x(()=>this.action$.pipe(D(Wi),L(({})=>{this.loadingSerivce.setOtherLoading("loaded")})),{dispatch:!1}),this.confirmVerifyEmail_success$=x(()=>this.action$.pipe(D(Oa),L(()=>{this.loadingSerivce.setOtherLoading("loaded")})),{dispatch:!1}),this.processFailure$=x(()=>this.action$.pipe(D(In,Mi,Fi,Aa,An,Bi,Lt,xa),L(u=>{console.log("action",u),this.loadingSerivce.setOtherLoading("error"),this.toastMT.handleError(u.error)})),{dispatch:!1})}};e.\u0275fac=function(s){return new(s||e)(v(Bn),v(Oe),v(de),v(Sn),v(pt),v(la),v(Tn),v(rt))},e.\u0275prov=Y({token:e,factory:e.\u0275fac});let t=e;return t})();var sl=(()=>{let e=class e{constructor(i,s,r,o,a){this.message=i,this.router=s,this.authService=r,this.loadingSerivce=o,this.responseMS=a}intercept(i,s){return s.handle(i).pipe(B(r=>{let{status:o,headers:a,ok:c,error:l}=r;return o===500?this.handleApiError(i,s,r):o===400?this.handleBadRequest(i,s,r):o===401?this.handleUnauthorized(i,s,r):o===403?this.handleForbidden(i,s,r):o===403?this.handleForbidden(i,s,r):o===404?this.handleNotFound(i,s,r):!o&&!a.keys().length&&!c&&!l.loaded&&!l.total?this.handleUnknownError(i,s,r):me(()=>r)}))}handleForbidden(i,s,r){return this.message.create("error","B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp v\xE0o h\u1EC7 th\u1ED1ng"),this.authService.endSession(),this.loadingSerivce.setOtherLoading("error"),me(()=>r)}handleApiError(i,s,r){let{}=r;return this.loadingSerivce.setOtherLoading("error"),me(()=>r)}handleBadRequest(i,s,r){let{error:o}=r,a=o;return console.log("<<<<<line 93>>>>>",a),this.loadingSerivce.setOtherLoading("error"),me(()=>a)}handleUnknownError(i,s,r){let{}=r;return this.loadingSerivce.setOtherLoading("error"),console.warn(r),me(()=>r)}handleNotFound(i,s,r){return this.loadingSerivce.setOtherLoading("error"),me(()=>r)}handleExpiredToken(i,s,r){return this.loadingSerivce.setOtherLoading("error"),me(()=>r)}handleUnauthorized(i,s,r){return this.loadingSerivce.setOtherLoading("error"),me(()=>r)}};e.\u0275fac=function(s){return new(s||e)(v(Tn),v(de),v(Oe),v(pt),v(rt))},e.\u0275prov=Y({token:e,factory:e.\u0275fac});let t=e;return t})();var $d=[Pe.Login.api,Pe.ForgotPassWord.api,Pe.Register.api,Pe.ResetPassWord.api,Pe.VerifyEmail.api,Pe.IsExistEmail.api,Pe.ConfirmEmail.api,Hi.ListCategory.api,Hi.ListSubCategory.api,"https://esgoo.net/api-tinhthanh/",Fn.RentalShopProduct.api,Fn.GetDetailProduct.api,Fn.ListProduct.api,oc.GetRentalShop.api,ac.ListFeedBack.api,Un.ListVoucher.api,Un.MyVoucher.api],jd=[Un.MyVoucher.api],rl=(t,e)=>{let n=te(Oe),i=n.token,s=te(rt),r=$d.some(a=>t.url.includes(a));if(!i&&!r&&n.isTokenExpired())return s.handleError("H\u1EBFt phi\xEAn token vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i",401),so(3e3).pipe(H(()=>(n.logout(),me(()=>new Error("Token expired, please log in again.")))));let o=!r&&i||jd?t.clone({setHeaders:{Authorization:`Bearer ${i}`}}):t;return e(o)};var ol=(t,e)=>e(t).pipe(O(n=>{if(n instanceof Do){let s=n.body;if(s&&s.datas){let i=s,{datas:r}=i,o=Xr(i,["datas"]),a=P({data:r},o);return n.clone({body:a})}}return n}));function al(t){return function(e,n){return t(e,n)}}var cl=Fa;function zd(){let t={};return cl.forEach(e=>{let n=localStorage.getItem(e);if(n)try{t[e]=JSON.parse(n)}catch(i){console.error(`Error parsing ${e} from localStorage`,i)}}),t}function ll(t){return(e,n)=>{if(n.type===xt||n.type===Dt){let s=zd();e=P(P({},e),s)}let i=t(e,n);return cl.forEach(s=>{i?.hasOwnProperty(s)&&localStorage.setItem(s,JSON.stringify(i[s]))}),i}}var ul=[al,ll];var Vd="[address vietnam] init province",qd="[address vietnam] success provice",Hd="[address vietnam] failure provice",Gd="[address vietnam] init disctrict",Kd="[address vietnam] success disctrict",Yd="[address vietnam] failure district",Qd="[address vietnam] init ward or commune",Xd="[address vietnam] success ward or commune",Zd="[address vietnam] failure ward or commune",Qn=Q(Vd),jt=Q(qd,ie()),zt=Q(Hd,ie()),Xn=Q(Gd,ie()),Vt=Q(Kd,ie()),qt=Q(Yd,ie()),Zn=Q(Qd,ie()),Ht=Q(Xd,ie()),Gt=Q(Zd,ie());var dl=(()=>{let e=class e{constructor(i){this.httpClient=i,this.ADDRESS_VIETNAM_URL="https://esgoo.net/api-tinhthanh/"}getListProvince(){return this.httpClient.post(`${this.ADDRESS_VIETNAM_URL}1/0.htm`)}getListDistrict(i){return this.httpClient.post(`${this.ADDRESS_VIETNAM_URL}2/${i}.htm`)}getListWardCommune(i){return this.httpClient.post(`${this.ADDRESS_VIETNAM_URL}3/${i}.htm`)}};e.\u0275fac=function(s){return new(s||e)(v(cc))},e.\u0275prov=Y({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var fl=(()=>{let e=class e{constructor(i,s){this.action$=i,this.provinceService=s,this.getProvince_process$=x(()=>this.action$.pipe(D(Qn),H(()=>this.provinceService.getListProvince().pipe(O(r=>jt({dataP:r.data})),B(()=>U(zt({errorMessage:""})))))),{dispatch:!0}),this.getDistrict_process$=x(()=>this.action$.pipe(D(Xn),H(({id:r})=>this.provinceService.getListDistrict(r).pipe(O(o=>Vt({dataD:o.data})),B(()=>U(qt({errorMessage:""})))))),{dispatch:!0}),this.gettWardOrCommume_process$=x(()=>this.action$.pipe(D(Zn),H(({id:r})=>this.provinceService.getListWardCommune(r).pipe(O(o=>Ht({dataW:o.data})),B(()=>U(Gt({errorMessage:""})))))),{dispatch:!0}),this.processSuccess$=x(()=>this.action$.pipe(D(jt,Vt,Ht),L(r=>{})),{dispatch:!1}),this.processFailure$=x(()=>this.action$.pipe(D(qt,zt,Gt),L(r=>{console.log("error:",r)})),{dispatch:!1})}};e.\u0275fac=function(s){return new(s||e)(v(Bn),v(dl))},e.\u0275prov=Y({token:e,factory:e.\u0275fac});let t=e;return t})();var ef={dataProvince:[],dataDistrict:[],dataWard:[],message:"",statusProvince:"idle",statusDistrict:"idle",statusWard:"idle"},tf=Ea(ef,be(Qn,t=>q(P({},t),{message:"",statusProvince:"loading"})),be(jt,(t,e)=>q(P({},t),{dataProvince:e.dataP,statusProvince:"loaded"})),be(zt,(t,e)=>q(P({},t),{message:e.errorMessage,statusProvince:"error"})),be(Xn,t=>q(P({},t),{message:"",statusDistrict:"loading"})),be(Vt,(t,e)=>q(P({},t),{dataDistrict:e.dataD,statusDistrict:"loaded"})),be(qt,(t,e)=>q(P({},t),{message:e.errorMessage,statusDistrict:"error"})),be(Zn,t=>q(P({},t),{message:"",statusWard:"loading"})),be(Ht,(t,e)=>q(P({},t),{dataWard:e.dataW,statusWard:"loaded"})),be(Gt,(t,e)=>q(P({},t),{message:e.errorMessage,statusWard:"error"}))),ds=wa({name:La("addressVNFeature"),reducer:tf}),{selectDataDistrict:_v,selectDataProvince:mv,selectDataWard:gv,selectStatusDistrict:yv,selectStatusProvince:vv,selectStatusWard:wv}=ds;var pl="@firebase/database",_l="1.0.8";var ur="";function nf(t){ur=t}var ws=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),W(n))}get(e){let n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:On(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var Es=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return Re(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var Gl=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){let e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new ws(e)}}catch{}return new Es},Ge=Gl("localStorage"),Ts=Gl("sessionStorage");var wt=new Ja("@firebase/database"),sf=function(){let t=1;return function(){return t++}}(),Kl=function(t){let e=Xa(t),n=new Ya;n.update(e);let i=n.digest();return Ba.encodeByteArray(i)},an=function(...t){let e="";for(let n=0;n<t.length;n++){let i=t[n];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=an.apply(null,i):typeof i=="object"?e+=W(i):e+=i,e+=" "}return e},Ke=null,ml=!0,rf=function(t,e){p(!e||t===!0||t===!1,"Can't turn on custom loggers persistently."),t===!0?(wt.logLevel=Za.VERBOSE,Ke=wt.log.bind(wt),e&&Ts.set("logging_enabled",!0)):typeof t=="function"?Ke=t:(Ke=null,Ts.remove("logging_enabled"))},X=function(...t){if(ml===!0&&(ml=!1,Ke===null&&Ts.get("logging_enabled")===!0&&rf(!0)),Ke){let e=an.apply(null,t);Ke(e)}},cn=function(t){return function(...e){X(t,...e)}},Cs=function(...t){let e="FIREBASE INTERNAL ERROR: "+an(...t);wt.error(e)},Fe=function(...t){let e=`FIREBASE FATAL ERROR: ${an(...t)}`;throw wt.error(e),new Error(e)},le=function(...t){let e="FIREBASE WARNING: "+an(...t);wt.warn(e)},of=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&le("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Yl=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},af=function(t){if(Ae()||document.readyState==="complete")t();else{let e=!1,n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},Tt="[MIN_NAME]",Ye="[MAX_NAME]",kt=function(t,e){if(t===e)return 0;if(t===Tt||e===Ye)return-1;if(e===Tt||t===Ye)return 1;{let n=gl(t),i=gl(e);return n!==null?i!==null?n-i===0?t.length-e.length:n-i:-1:i!==null?1:t<e?-1:1}},cf=function(t,e){return t===e?0:t<e?-1:1},Kt=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+W(e))},hr=function(t){if(typeof t!="object"||t===null)return W(t);let e=[];for(let i in t)e.push(i);e.sort();let n="{";for(let i=0;i<e.length;i++)i!==0&&(n+=","),n+=W(e[i]),n+=":",n+=hr(t[e[i]]);return n+="}",n},Ql=function(t,e){let n=t.length;if(n<=e)return[t];let i=[];for(let s=0;s<n;s+=e)s+e>n?i.push(t.substring(s,n)):i.push(t.substring(s,s+e));return i};function _e(t,e){for(let n in t)t.hasOwnProperty(n)&&e(n,t[n])}var Xl=function(t){p(!Yl(t),"Invalid JSON number");let e=11,n=52,i=(1<<e-1)-1,s,r,o,a,c;t===0?(r=0,o=0,s=1/t===-1/0?1:0):(s=t<0,t=Math.abs(t),t>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),i),r=a+i,o=Math.round(t*Math.pow(2,n-a)-Math.pow(2,n))):(r=0,o=Math.round(t/Math.pow(2,1-i-n))));let l=[];for(c=n;c;c-=1)l.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)l.push(r%2?1:0),r=Math.floor(r/2);l.push(s?1:0),l.reverse();let h=l.join(""),u="";for(c=0;c<64;c+=8){let d=parseInt(h.substr(c,8),2).toString(16);d.length===1&&(d="0"+d),u=u+d}return u.toLowerCase()},lf=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},uf=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};var hf=new RegExp("^-?(0*)\\d{1,10}$"),df=-2147483648,ff=2147483647,gl=function(t){if(hf.test(t)){let e=Number(t);if(e>=df&&e<=ff)return e}return null},ln=function(t){try{t()}catch(e){setTimeout(()=>{let n=e.stack||"";throw le("Exception was thrown by user callback.",n),e},Math.floor(0))}},pf=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Jt=function(t,e){let n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};var Ss=class{constructor(e,n){this.appName_=e,this.appCheckProvider=n,this.appCheck=n?.getImmediate({optional:!0}),this.appCheck||n?.get().then(i=>this.appCheck=i)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((n,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,i):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)===null||n===void 0||n.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){le(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var Is=class{constructor(e,n,i){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(X("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,i):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',le(e)}},en=(()=>{class t{constructor(n){this.accessToken=n}getToken(n){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(n){n(this.accessToken)}removeTokenChangeListener(n){}notifyForInvalidToken(){}}t.OWNER="owner";return t})(),ei="5",Zl="v",Jl="s",eu="r",tu="f",nu=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,iu="ls",su="p",bs="ac",ru="websocket",ou="long_polling";var ti=class{constructor(e,n,i,s,r=!1,o="",a=!1,c=!1){this.secure=n,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ge.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ge.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}};function _f(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function au(t,e,n){p(typeof e=="string","typeof type must == string"),p(typeof n=="object","typeof params must == object");let i;if(e===ru)i=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===ou)i=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);_f(t)&&(n.ns=t.namespace);let s=[];return _e(n,(r,o)=>{s.push(r+"="+o)}),i+s.join("&")}var As=class{constructor(){this.counters_={}}incrementCounter(e,n=1){Re(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return $a(this.counters_)}};var fs={},ps={};function dr(t){let e=t.toString();return fs[e]||(fs[e]=new As),fs[e]}function mf(t,e){let n=t.toString();return ps[n]||(ps[n]=e()),ps[n]}var Rs=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){let i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&ln(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var yl="start",gf="close",yf="pLPCommand",vf="pRTLPCB",cu="id",lu="pw",uu="ser",wf="cb",Ef="seg",Tf="ts",Cf="d",Sf="dframe",hu=1870,du=30,If=hu-du,bf=25e3,Af=3e4,ks=class t{constructor(e,n,i,s,r,o,a){this.connId=e,this.repoInfo=n,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=cn(e),this.stats_=dr(n),this.urlFn=c=>(this.appCheckToken&&(c[bs]=this.appCheckToken),au(n,ou,c))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new Rs(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Af)),af(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Ns((...r)=>{let[o,a,c,l,h]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===yl)this.id=a,this.password=c;else if(o===gf)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{let[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let i={};i[yl]="t",i[uu]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[wf]=this.scriptTagHolder.uniqueCallbackIdentifier),i[Zl]=ei,this.transportSessionId&&(i[Jl]=this.transportSessionId),this.lastSessionId&&(i[iu]=this.lastSessionId),this.applicationId&&(i[su]=this.applicationId),this.appCheckToken&&(i[bs]=this.appCheckToken),typeof location<"u"&&location.hostname&&nu.test(location.hostname)&&(i[eu]=tu);let s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){t.forceAllow_=!0}static forceDisallow(){t.forceDisallow_=!0}static isAvailable(){return Ae()?!1:t.forceAllow_?!0:!t.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!lf()&&!uf()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let n=W(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);let i=Wa(n),s=Ql(i,If);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(e,n){if(Ae())return;this.myDisconnFrame=document.createElement("iframe");let i={};i[Sf]="t",i[cu]=e,i[lu]=n,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let n=W(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}},Ns=class t{constructor(e,n,i,s){if(this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,Ae())this.commandCB=e,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=sf(),window[yf+this.uniqueCallbackIdentifier]=e,window[vf+this.uniqueCallbackIdentifier]=n,this.myIFrame=t.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){X("frame writing exception"),a.stack&&X(a.stack),X(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||X("No IE domain setting required")}catch{let i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[cu]=this.myID,e[lu]=this.myPW,e[uu]=this.currentSerial;let n=this.urlFn(e),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+du+i.length<=hu;){let o=this.pendingSegs.shift();i=i+"&"+Ef+s+"="+o.seg+"&"+Tf+s+"="+o.ts+"&"+Cf+s+"="+o.d,s++}return n=n+i,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,i){this.pendingSegs.push({seg:e,ts:n,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);let i=()=>{this.outstandingRequests.delete(n),this.newRequest_()},s=setTimeout(i,Math.floor(bf)),r=()=>{clearTimeout(s),i()};this.addTag(e,r)}addTag(e,n){Ae()?this.doNodeLongPoll(e,n):setTimeout(()=>{try{if(!this.sendNewPolls)return;let i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){let s=i.readyState;(!s||s==="loaded"||s==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),n())},i.onerror=()=>{X("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}};var Rf=16384,kf=45e3,ni=null;typeof MozWebSocket<"u"?ni=MozWebSocket:typeof WebSocket<"u"&&(ni=WebSocket);var Yt=(()=>{class t{constructor(n,i,s,r,o,a,c){this.connId=n,this.applicationId=s,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=cn(this.connId),this.stats_=dr(i),this.connURL=t.connectionURL_(i,a,c,r,s),this.nodeAdmin=i.nodeAdmin}static connectionURL_(n,i,s,r,o){let a={};return a[Zl]=ei,!Ae()&&typeof location<"u"&&location.hostname&&nu.test(location.hostname)&&(a[eu]=tu),i&&(a[Jl]=i),s&&(a[iu]=s),r&&(a[bs]=r),o&&(a[su]=o),au(n,ru,a)}open(n,i){this.onDisconnect=i,this.onMessage=n,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ge.set("previous_websocket_failure",!0);try{let s;if(Ae()){let r=this.nodeAdmin?"AdminNode":"Node";s={headers:{"User-Agent":`Firebase/${ei}/${ur}/${process.platform}/${r}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(s.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(s.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(s.proxy={origin:a})}this.mySock=new ni(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");let r=s.message||s.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");let r=s.message||s.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){t.forceDisallow_=!0}static isAvailable(){let n=!1;if(typeof navigator<"u"&&navigator.userAgent){let i=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(i);s&&s.length>1&&parseFloat(s[1])<4.4&&(n=!0)}return!n&&ni!==null&&!t.forceDisallow_}static previouslyFailed(){return Ge.isInMemoryStorage||Ge.get("previous_websocket_failure")===!0}markConnectionHealthy(){Ge.remove("previous_websocket_failure")}appendFrame_(n){if(this.frames.push(n),this.frames.length===this.totalFrames){let i=this.frames.join("");this.frames=null;let s=On(i);this.onMessage(s)}}handleNewFrameCount_(n){this.totalFrames=n,this.frames=[]}extractFrameCount_(n){if(p(this.frames===null,"We already have a frame buffer"),n.length<=6){let i=Number(n);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),n}handleIncomingFrame(n){if(this.mySock===null)return;let i=n.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(i);else{let s=this.extractFrameCount_(i);s!==null&&this.appendFrame_(s)}}send(n){this.resetKeepAlive();let i=W(n);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);let s=Ql(i,Rf);s.length>1&&this.sendString_(String(s.length));for(let r=0;r<s.length;r++)this.sendString_(s[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(kf))}sendString_(n){try{this.mySock.send(n)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4;return t})(),Nf=(()=>{class t{constructor(n){this.initTransports_(n)}static get ALL_TRANSPORTS(){return[ks,Yt]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(n){let i=Yt&&Yt.isAvailable(),s=i&&!Yt.previouslyFailed();if(n.webSocketOnly&&(i||le("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[Yt];else{let r=this.transports_=[];for(let o of t.ALL_TRANSPORTS)o&&o.isAvailable()&&r.push(o);t.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}t.globalTransportInitialized_=!1;return t})(),Pf=6e4,Of=5e3,xf=10*1024,Df=100*1024,_s="t",vl="d",Mf="s",wl="r",Lf="e",El="o",Tl="a",Cl="n",Sl="p",Ff="h",Ps=class{constructor(e,n,i,s,r,o,a,c,l,h){this.id=e,this.repoInfo_=n,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=l,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=cn("c:"+this.id+":"),this.transportManager_=new Nf(n),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let n=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,i)},Math.floor(0));let s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=Jt(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Df?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>xf?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){let n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(_s in e){let n=e[_s];n===Tl?this.upgradeIfSecondaryHealthy_():n===wl?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===El&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let n=Kt("t",e),i=Kt("d",e);if(n==="c")this.onSecondaryControl_(i);else if(n==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Sl,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Tl,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Cl,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let n=Kt("t",e),i=Kt("d",e);n==="c"?this.onControl_(i):n==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let n=Kt(_s,e);if(vl in e){let i=e[vl];if(n===Ff){let s=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(n===Cl){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===Mf?this.onConnectionShutdown_(i):n===wl?this.onReset_(i):n===Lf?Cs("Server Error: "+i):n===El?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Cs("Unknown control packet command: "+n)}}onHandshake_(e){let n=e.ts,i=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),ei!==i&&le("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let n=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,i),Jt(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Pf))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Jt(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Of))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Sl,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ge.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var ii=class{put(e,n,i,s){}merge(e,n,i,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,i){}onDisconnectMerge(e,n,i){}onDisconnectCancel(e,n){}reportStats(e){}};var si=class{constructor(e){this.allowedEvents_=e,this.listeners_={},p(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){let i=[...this.listeners_[e]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,n)}}on(e,n,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:i});let s=this.getInitialEvent(e);s&&n.apply(i,s)}off(e,n,i){this.validateEventType_(e);let s=this.listeners_[e]||[];for(let r=0;r<s.length;r++)if(s[r].callback===n&&(!i||i===s[r].context)){s.splice(r,1);return}}validateEventType_(e){p(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}};var ri=class t extends si{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!ji()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new t}getInitialEvent(e){return p(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var Il=32,bl=768,A=class{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}};function b(){return new A("")}function T(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function je(t){return t.pieces_.length-t.pieceNum_}function k(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new A(t.pieces_,e)}function fu(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function Uf(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function pu(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function _u(t){if(t.pieceNum_>=t.pieces_.length)return null;let e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new A(e,0)}function j(t,e){let n=[];for(let i=t.pieceNum_;i<t.pieces_.length;i++)n.push(t.pieces_[i]);if(e instanceof A)for(let i=e.pieceNum_;i<e.pieces_.length;i++)n.push(e.pieces_[i]);else{let i=e.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&n.push(i[s])}return new A(n,0)}function E(t){return t.pieceNum_>=t.pieces_.length}function fe(t,e){let n=T(t),i=T(e);if(n===null)return e;if(n===i)return fe(k(t),k(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function mu(t,e){if(je(t)!==je(e))return!1;for(let n=t.pieceNum_,i=e.pieceNum_;n<=t.pieces_.length;n++,i++)if(t.pieces_[n]!==e.pieces_[i])return!1;return!0}function ve(t,e){let n=t.pieceNum_,i=e.pieceNum_;if(je(t)>je(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[i])return!1;++n,++i}return!0}var Os=class{constructor(e,n){this.errorPrefix_=n,this.parts_=pu(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=Ut(this.parts_[i]);gu(this)}};function Bf(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=Ut(e),gu(t)}function Wf(t){let e=t.parts_.pop();t.byteLength_-=Ut(e),t.parts_.length>0&&(t.byteLength_-=1)}function gu(t){if(t.byteLength_>bl)throw new Error(t.errorPrefix_+"has a key path longer than "+bl+" bytes ("+t.byteLength_+").");if(t.parts_.length>Il)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Il+") or object contains a cycle "+He(t))}function He(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}var xs=class t extends si{constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{let i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new t}getInitialEvent(e){return p(e==="visible","Unknown event type: "+e),[this.visible_]}};var Qt=1e3,$f=60*5*1e3,Al=30*1e3,jf=1.3,zf=3e4,Vf="server_kill",Rl=3,fr=(()=>{class t extends ii{constructor(n,i,s,r,o,a,c,l){if(super(),this.repoInfo_=n,this.applicationId_=i,this.onDataUpdate_=s,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=c,this.authOverride_=l,this.id=t.nextPersistentConnectionId_++,this.log_=cn("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Qt,this.maxReconnectDelay_=$f,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!Ae())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");xs.getInstance().on("visible",this.onVisible_,this),n.host.indexOf("fblocal")===-1&&ri.getInstance().on("online",this.onOnline_,this)}sendRequest(n,i,s){let r=++this.requestNumber_,o={r,a:n,b:i};this.log_(W(o)),p(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),s&&(this.requestCBHash_[r]=s)}get(n){this.initConnection_();let i=new $i,r={action:"g",request:{p:n._path.toString(),q:n._queryObject},onComplete:a=>{let c=a.d;a.s==="ok"?i.resolve(c):i.reject(c)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),i.promise}listen(n,i,s,r){this.initConnection_();let o=n._queryIdentifier,a=n._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),p(n._queryParams.isDefault()||!n._queryParams.loadsAllData(),"listen() called for non-default but complete query"),p(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let c={onComplete:r,hashFn:i,query:n,tag:s};this.listens.get(a).set(o,c),this.connected_&&this.sendListen_(c)}sendGet_(n){let i=this.outstandingGets_[n];this.sendRequest("g",i.request,s=>{delete this.outstandingGets_[n],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(s)})}sendListen_(n){let i=n.query,s=i._path.toString(),r=i._queryIdentifier;this.log_("Listen on "+s+" for "+r);let o={p:s},a="q";n.tag&&(o.q=i._queryObject,o.t=n.tag),o.h=n.hashFn(),this.sendRequest(a,o,c=>{let l=c.d,h=c.s;t.warnOnListenWarnings_(l,i),(this.listens.get(s)&&this.listens.get(s).get(r))===n&&(this.log_("listen response",c),h!=="ok"&&this.removeListen_(s,r),n.onComplete&&n.onComplete(h,l))})}static warnOnListenWarnings_(n,i){if(n&&typeof n=="object"&&Re(n,"w")){let s=ze(n,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){let r='".indexOn": "'+i._queryParams.getIndex().toString()+'"',o=i._path.toString();le(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(n){this.authToken_=n,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(n)}reduceReconnectDelayIfAdminCredential_(n){(n&&n.length===40||Ga(n))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Al)}refreshAppCheckToken(n){this.appCheckToken_=n,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let n=this.authToken_,i=Ha(n)?"auth":"gauth",s={cred:n};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(i,s,r=>{let o=r.s,a=r.d||"error";this.authToken_===n&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},n=>{let i=n.s,s=n.d||"error";i==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,s)})}unlisten(n,i){let s=n._path.toString(),r=n._queryIdentifier;this.log_("Unlisten called for "+s+" "+r),p(n._queryParams.isDefault()||!n._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,r)&&this.connected_&&this.sendUnlisten_(s,r,n._queryObject,i)}sendUnlisten_(n,i,s,r){this.log_("Unlisten on "+n+" for "+i);let o={p:n},a="n";r&&(o.q=s,o.t=r),this.sendRequest(a,o)}onDisconnectPut(n,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",n,i,s):this.onDisconnectRequestQueue_.push({pathString:n,action:"o",data:i,onComplete:s})}onDisconnectMerge(n,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",n,i,s):this.onDisconnectRequestQueue_.push({pathString:n,action:"om",data:i,onComplete:s})}onDisconnectCancel(n,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",n,null,i):this.onDisconnectRequestQueue_.push({pathString:n,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(n,i,s,r){let o={p:i,d:s};this.log_("onDisconnect "+n,o),this.sendRequest(n,o,a=>{r&&setTimeout(()=>{r(a.s,a.d)},Math.floor(0))})}put(n,i,s,r){this.putInternal("p",n,i,s,r)}merge(n,i,s,r){this.putInternal("m",n,i,s,r)}putInternal(n,i,s,r,o){this.initConnection_();let a={p:i,d:s};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:n,request:a,onComplete:r}),this.outstandingPutCount_++;let c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+i)}sendPut_(n){let i=this.outstandingPuts_[n].action,s=this.outstandingPuts_[n].request,r=this.outstandingPuts_[n].onComplete;this.outstandingPuts_[n].queued=this.connected_,this.sendRequest(i,s,o=>{this.log_(i+" response",o),delete this.outstandingPuts_[n],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(o.s,o.d)})}reportStats(n){if(this.connected_){let i={c:n};this.log_("reportStats",i),this.sendRequest("s",i,s=>{if(s.s!=="ok"){let o=s.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(n){if("r"in n){this.log_("from server: "+W(n));let i=n.r,s=this.requestCBHash_[i];s&&(delete this.requestCBHash_[i],s(n.b))}else{if("error"in n)throw"A server-side error has occurred: "+n.error;"a"in n&&this.onDataPush_(n.a,n.b)}}onDataPush_(n,i){this.log_("handleServerMessage",n,i),n==="d"?this.onDataUpdate_(i.p,i.d,!1,i.t):n==="m"?this.onDataUpdate_(i.p,i.d,!0,i.t):n==="c"?this.onListenRevoked_(i.p,i.q):n==="ac"?this.onAuthRevoked_(i.s,i.d):n==="apc"?this.onAppCheckRevoked_(i.s,i.d):n==="sd"?this.onSecurityDebugPacket_(i):Cs("Unrecognized action received from server: "+W(n)+`
Are you using the latest client?`)}onReady_(n,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(n),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(n){p(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(n))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(n){n&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Qt,this.realtime_||this.scheduleConnect_(0)),this.visible_=n}onOnline_(n){n?(this.log_("Browser went online."),this.reconnectDelay_=Qt,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>zf&&(this.reconnectDelay_=Qt),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let n=new Date().getTime()-this.lastConnectionAttemptTime_,i=Math.max(0,this.reconnectDelay_-n);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*jf)}this.onConnectStatus_(!1)}establishConnection_(){return g(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let n=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+t.nextConnectionId_++,o=this.lastSessionId,a=!1,c=null,l=function(){c?c.close():(a=!0,s())},h=function(d){p(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(d)};this.realtime_={close:l,sendRequest:h};let u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[d,_]=yield Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);a?X("getToken() completed but was canceled"):(X("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=_&&_.token,c=new Ps(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,n,i,s,f=>{le(f+" ("+this.repoInfo_.toString()+")"),this.interrupt(Vf)},o))}catch(d){this.log_("Failed to get token: "+d),a||(this.repoInfo_.nodeAdmin&&le(d),l())}}})}interrupt(n){X("Interrupting connection for reason: "+n),this.interruptReasons_[n]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(n){X("Resuming connection for reason: "+n),delete this.interruptReasons_[n],zi(this.interruptReasons_)&&(this.reconnectDelay_=Qt,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(n){let i=n-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let n=0;n<this.outstandingPuts_.length;n++){let i=this.outstandingPuts_[n];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[n],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(n,i){let s;i?s=i.map(o=>hr(o)).join("$"):s="default";let r=this.removeListen_(n,s);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(n,i){let s=new A(n).toString(),r;if(this.listens.has(s)){let o=this.listens.get(s);r=o.get(i),o.delete(i),o.size===0&&this.listens.delete(s)}else r=void 0;return r}onAuthRevoked_(n,i){X("Auth token revoked: "+n+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(n==="invalid_token"||n==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Rl&&(this.reconnectDelay_=Al,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(n,i){X("App check token revoked: "+n+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(n==="invalid_token"||n==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Rl&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(n){this.securityDebugCallback_?this.securityDebugCallback_(n):"msg"in n&&console.log("FIREBASE: "+n.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let n of this.listens.values())for(let i of n.values())this.sendListen_(i);for(let n=0;n<this.outstandingPuts_.length;n++)this.outstandingPuts_[n]&&this.sendPut_(n);for(;this.onDisconnectRequestQueue_.length;){let n=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(n.action,n.pathString,n.data,n.onComplete)}for(let n=0;n<this.outstandingGets_.length;n++)this.outstandingGets_[n]&&this.sendGet_(n)}sendConnectStats_(){let n={},i="js";Ae()&&(this.repoInfo_.nodeAdmin?i="admin_node":i="node"),n["sdk."+i+"."+ur.replace(/\./g,"-")]=1,ji()?n["framework.cordova"]=1:ja()&&(n["framework.reactnative"]=1),this.reportStats(n)}shouldReconnect_(){let n=ri.getInstance().currentlyOnline();return zi(this.interruptReasons_)&&n}}t.nextPersistentConnectionId_=0,t.nextConnectionId_=0;return t})(),C=class t{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new t(e,n)}};var Ct=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){let i=new C(Tt,e),s=new C(Tt,n);return this.compare(i,s)!==0}minPost(){return C.MIN}};var Jn,oi=class extends Ct{static get __EMPTY_NODE(){return Jn}static set __EMPTY_NODE(e){Jn=e}compare(e,n){return kt(e.name,n.name)}isDefinedOn(e){throw ot("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return C.MIN}maxPost(){return new C(Ye,Jn)}makePost(e,n){return p(typeof e=="string","KeyIndex indexValue must always be a string."),new C(e,Jn)}toString(){return".key"}},Et=new oi;var yt=class{constructor(e,n,i,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?i(e.key,n):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},ye=(()=>{class t{constructor(n,i,s,r,o){this.key=n,this.value=i,this.color=s??t.RED,this.left=r??pe.EMPTY_NODE,this.right=o??pe.EMPTY_NODE}copy(n,i,s,r,o){return new t(n??this.key,i??this.value,s??this.color,r??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(n){return this.left.inorderTraversal(n)||!!n(this.key,this.value)||this.right.inorderTraversal(n)}reverseTraversal(n){return this.right.reverseTraversal(n)||n(this.key,this.value)||this.left.reverseTraversal(n)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(n,i,s){let r=this,o=s(n,r.key);return o<0?r=r.copy(null,null,null,r.left.insert(n,i,s),null):o===0?r=r.copy(null,i,null,null,null):r=r.copy(null,null,null,null,r.right.insert(n,i,s)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return pe.EMPTY_NODE;let n=this;return!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.removeMin_(),null),n.fixUp_()}remove(n,i){let s,r;if(s=this,i(n,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(n,i),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),i(n,s.key)===0){if(s.right.isEmpty())return pe.EMPTY_NODE;r=s.right.min_(),s=s.copy(r.key,r.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(n,i))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let n=this;return n.right.isRed_()&&!n.left.isRed_()&&(n=n.rotateLeft_()),n.left.isRed_()&&n.left.left.isRed_()&&(n=n.rotateRight_()),n.left.isRed_()&&n.right.isRed_()&&(n=n.colorFlip_()),n}moveRedLeft_(){let n=this.colorFlip_();return n.right.left.isRed_()&&(n=n.copy(null,null,null,null,n.right.rotateRight_()),n=n.rotateLeft_(),n=n.colorFlip_()),n}moveRedRight_(){let n=this.colorFlip_();return n.left.left.isRed_()&&(n=n.rotateRight_(),n=n.colorFlip_()),n}rotateLeft_(){let n=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,n,null)}rotateRight_(){let n=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,n)}colorFlip_(){let n=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,n,i)}checkMaxDepth_(){let n=this.check_();return Math.pow(2,n)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let n=this.left.check_();if(n!==this.right.check_())throw new Error("Black depths differ");return n+(this.isRed_()?0:1)}}return t.RED=!0,t.BLACK=!1,t})(),Ds=class{copy(e,n,i,s,r){return this}insert(e,n,i){return new ye(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},pe=class t{constructor(e,n=t.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new t(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,ye.BLACK,null,null))}remove(e){return new t(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,ye.BLACK,null,null))}get(e){let n,i=this.root_;for(;!i.isEmpty();){if(n=this.comparator_(e,i.key),n===0)return i.value;n<0?i=i.left:n>0&&(i=i.right)}return null}getPredecessorKey(e){let n,i=this.root_,s=null;for(;!i.isEmpty();)if(n=this.comparator_(e,i.key),n===0){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else n<0?i=i.left:n>0&&(s=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new yt(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new yt(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new yt(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new yt(this.root_,null,this.comparator_,!0,e)}};pe.EMPTY_NODE=new Ds;function qf(t,e){return kt(t.name,e.name)}function pr(t,e){return kt(t,e)}var Ms;function Hf(t){Ms=t}var yu=function(t){return typeof t=="number"?"number:"+Xl(t):"string:"+t},vu=function(t){if(t.isLeafNode()){let e=t.val();p(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Re(e,".sv"),"Priority must be a string or number.")}else p(t===Ms||t.isEmpty(),"priority of unexpected type.");p(t===Ms||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var kl,St=(()=>{class t{constructor(n,i=t.__childrenNodeConstructor.EMPTY_NODE){this.value_=n,this.priorityNode_=i,this.lazyHash_=null,p(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),vu(this.priorityNode_)}static set __childrenNodeConstructor(n){kl=n}static get __childrenNodeConstructor(){return kl}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(n){return new t(this.value_,n)}getImmediateChild(n){return n===".priority"?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE}getChild(n){return E(n)?this:T(n)===".priority"?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(n,i){return null}updateImmediateChild(n,i){return n===".priority"?this.updatePriority(i):i.isEmpty()&&n!==".priority"?this:t.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(n,i).updatePriority(this.priorityNode_)}updateChild(n,i){let s=T(n);return s===null?i:i.isEmpty()&&s!==".priority"?this:(p(s!==".priority"||je(n)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,t.__childrenNodeConstructor.EMPTY_NODE.updateChild(k(n),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(n,i){return!1}val(n){return n&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let n="";this.priorityNode_.isEmpty()||(n+="priority:"+yu(this.priorityNode_.val())+":");let i=typeof this.value_;n+=i+":",i==="number"?n+=Xl(this.value_):n+=this.value_,this.lazyHash_=Kl(n)}return this.lazyHash_}getValue(){return this.value_}compareTo(n){return n===t.__childrenNodeConstructor.EMPTY_NODE?1:n instanceof t.__childrenNodeConstructor?-1:(p(n.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(n))}compareToLeafNode_(n){let i=typeof n.value_,s=typeof this.value_,r=t.VALUE_TYPE_ORDER.indexOf(i),o=t.VALUE_TYPE_ORDER.indexOf(s);return p(r>=0,"Unknown leaf type: "+i),p(o>=0,"Unknown leaf type: "+s),r===o?s==="object"?0:this.value_<n.value_?-1:this.value_===n.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(n){if(n===this)return!0;if(n.isLeafNode()){let i=n;return this.value_===i.value_&&this.priorityNode_.equals(i.priorityNode_)}else return!1}}t.VALUE_TYPE_ORDER=["object","boolean","number","string"];return t})(),wu,Eu;function Gf(t){wu=t}function Kf(t){Eu=t}var Ls=class extends Ct{compare(e,n){let i=e.node.getPriority(),s=n.node.getPriority(),r=i.compareTo(s);return r===0?kt(e.name,n.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return C.MIN}maxPost(){return new C(Ye,new St("[PRIORITY-POST]",Eu))}makePost(e,n){let i=wu(e);return new C(n,new St("[PRIORITY-POST]",i))}toString(){return".priority"}},J=new Ls;var Yf=Math.log(2),Fs=class{constructor(e){let n=r=>parseInt(Math.log(r)/Yf,10),i=r=>parseInt(Array(r+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;let s=i(this.count);this.bits_=e+1&s}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},ai=function(t,e,n,i){t.sort(e);let s=function(c,l){let h=l-c,u,d;if(h===0)return null;if(h===1)return u=t[c],d=n?n(u):u,new ye(d,u.node,ye.BLACK,null,null);{let _=parseInt(h/2,10)+c,f=s(c,_),m=s(_+1,l);return u=t[_],d=n?n(u):u,new ye(d,u.node,ye.BLACK,f,m)}},r=function(c){let l=null,h=null,u=t.length,d=function(f,m){let w=u-f,N=u;u-=f;let z=s(w+1,N),V=t[w],y=n?n(V):V;_(new ye(y,V.node,m,null,z))},_=function(f){l?(l.left=f,l=f):(h=f,l=f)};for(let f=0;f<c.count;++f){let m=c.nextBitIsOne(),w=Math.pow(2,c.count-(f+1));m?d(w,ye.BLACK):(d(w,ye.BLACK),d(w,ye.RED))}return h},o=new Fs(t.length),a=r(o);return new pe(i||e,a)};var ms,gt={},It=class t{constructor(e,n){this.indexes_=e,this.indexSet_=n}static get Default(){return p(gt&&J,"ChildrenNode.ts has not been loaded"),ms=ms||new t({".priority":gt},{".priority":J}),ms}get(e){let n=ze(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof pe?n:null}hasIndex(e){return Re(this.indexSet_,e.toString())}addIndex(e,n){p(e!==Et,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],s=!1,r=n.getIterator(C.Wrap),o=r.getNext();for(;o;)s=s||e.isDefinedOn(o.node),i.push(o),o=r.getNext();let a;s?a=ai(i,e.getCompare()):a=gt;let c=e.toString(),l=Object.assign({},this.indexSet_);l[c]=e;let h=Object.assign({},this.indexes_);return h[c]=a,new t(h,l)}addToIndexes(e,n){let i=Ft(this.indexes_,(s,r)=>{let o=ze(this.indexSet_,r);if(p(o,"Missing index implementation for "+r),s===gt)if(o.isDefinedOn(e.node)){let a=[],c=n.getIterator(C.Wrap),l=c.getNext();for(;l;)l.name!==e.name&&a.push(l),l=c.getNext();return a.push(e),ai(a,o.getCompare())}else return gt;else{let a=n.get(e.name),c=s;return a&&(c=c.remove(new C(e.name,a))),c.insert(e,e.node)}});return new t(i,this.indexSet_)}removeFromIndexes(e,n){let i=Ft(this.indexes_,s=>{if(s===gt)return s;{let r=n.get(e.name);return r?s.remove(new C(e.name,r)):s}});return new t(i,this.indexSet_)}};var Xt,M=(()=>{class t{constructor(n,i,s){this.children_=n,this.priorityNode_=i,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&vu(this.priorityNode_),this.children_.isEmpty()&&p(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Xt||(Xt=new t(new pe(pr),null,It.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Xt}updatePriority(n){return this.children_.isEmpty()?this:new t(this.children_,n,this.indexMap_)}getImmediateChild(n){if(n===".priority")return this.getPriority();{let i=this.children_.get(n);return i===null?Xt:i}}getChild(n){let i=T(n);return i===null?this:this.getImmediateChild(i).getChild(k(n))}hasChild(n){return this.children_.get(n)!==null}updateImmediateChild(n,i){if(p(i,"We should always be passing snapshot nodes"),n===".priority")return this.updatePriority(i);{let s=new C(n,i),r,o;i.isEmpty()?(r=this.children_.remove(n),o=this.indexMap_.removeFromIndexes(s,this.children_)):(r=this.children_.insert(n,i),o=this.indexMap_.addToIndexes(s,this.children_));let a=r.isEmpty()?Xt:this.priorityNode_;return new t(r,a,o)}}updateChild(n,i){let s=T(n);if(s===null)return i;{p(T(n)!==".priority"||je(n)===1,".priority must be the last token in a path");let r=this.getImmediateChild(s).updateChild(k(n),i);return this.updateImmediateChild(s,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(n){if(this.isEmpty())return null;let i={},s=0,r=0,o=!0;if(this.forEachChild(J,(a,c)=>{i[a]=c.val(n),s++,o&&t.INTEGER_REGEXP_.test(a)?r=Math.max(r,Number(a)):o=!1}),!n&&o&&r<2*s){let a=[];for(let c in i)a[c]=i[c];return a}else return n&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(this.lazyHash_===null){let n="";this.getPriority().isEmpty()||(n+="priority:"+yu(this.getPriority().val())+":"),this.forEachChild(J,(i,s)=>{let r=s.hash();r!==""&&(n+=":"+i+":"+r)}),this.lazyHash_=n===""?"":Kl(n)}return this.lazyHash_}getPredecessorChildName(n,i,s){let r=this.resolveIndex_(s);if(r){let o=r.getPredecessorKey(new C(n,i));return o?o.name:null}else return this.children_.getPredecessorKey(n)}getFirstChildName(n){let i=this.resolveIndex_(n);if(i){let s=i.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(n){let i=this.getFirstChildName(n);return i?new C(i,this.children_.get(i)):null}getLastChildName(n){let i=this.resolveIndex_(n);if(i){let s=i.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(n){let i=this.getLastChildName(n);return i?new C(i,this.children_.get(i)):null}forEachChild(n,i){let s=this.resolveIndex_(n);return s?s.inorderTraversal(r=>i(r.name,r.node)):this.children_.inorderTraversal(i)}getIterator(n){return this.getIteratorFrom(n.minPost(),n)}getIteratorFrom(n,i){let s=this.resolveIndex_(i);if(s)return s.getIteratorFrom(n,r=>r);{let r=this.children_.getIteratorFrom(n.name,C.Wrap),o=r.peek();for(;o!=null&&i.compare(o,n)<0;)r.getNext(),o=r.peek();return r}}getReverseIterator(n){return this.getReverseIteratorFrom(n.maxPost(),n)}getReverseIteratorFrom(n,i){let s=this.resolveIndex_(i);if(s)return s.getReverseIteratorFrom(n,r=>r);{let r=this.children_.getReverseIteratorFrom(n.name,C.Wrap),o=r.peek();for(;o!=null&&i.compare(o,n)>0;)r.getNext(),o=r.peek();return r}}compareTo(n){return this.isEmpty()?n.isEmpty()?0:-1:n.isLeafNode()||n.isEmpty()?1:n===un?-1:0}withIndex(n){if(n===Et||this.indexMap_.hasIndex(n))return this;{let i=this.indexMap_.addIndex(n,this.children_);return new t(this.children_,this.priorityNode_,i)}}isIndexed(n){return n===Et||this.indexMap_.hasIndex(n)}equals(n){if(n===this)return!0;if(n.isLeafNode())return!1;{let i=n;if(this.getPriority().equals(i.getPriority()))if(this.children_.count()===i.children_.count()){let s=this.getIterator(J),r=i.getIterator(J),o=s.getNext(),a=r.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=s.getNext(),a=r.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(n){return n===Et?null:this.indexMap_.get(n.toString())}}return t.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,t})(),Us=class extends M{constructor(){super(new pe(pr),M.EMPTY_NODE,It.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return M.EMPTY_NODE}isEmpty(){return!1}},un=new Us;Object.defineProperties(C,{MIN:{value:new C(Tt,M.EMPTY_NODE)},MAX:{value:new C(Ye,un)}});oi.__EMPTY_NODE=M.EMPTY_NODE;St.__childrenNodeConstructor=M;Hf(un);Kf(un);var Qf=!0;function Z(t,e=null){if(t===null)return M.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),p(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){let n=t;return new St(n,Z(e))}if(!(t instanceof Array)&&Qf){let n=[],i=!1;if(_e(t,(o,a)=>{if(o.substring(0,1)!=="."){let c=Z(a);c.isEmpty()||(i=i||!c.getPriority().isEmpty(),n.push(new C(o,c)))}}),n.length===0)return M.EMPTY_NODE;let r=ai(n,qf,o=>o.name,pr);if(i){let o=ai(n,J.getCompare());return new M(r,Z(e),new It({".priority":o},{".priority":J}))}else return new M(r,Z(e),It.Default)}else{let n=M.EMPTY_NODE;return _e(t,(i,s)=>{if(Re(t,i)&&i.substring(0,1)!=="."){let r=Z(s);(r.isLeafNode()||!r.isEmpty())&&(n=n.updateImmediateChild(i,r))}}),n.updatePriority(Z(e))}}Gf(Z);var Bs=class extends Ct{constructor(e){super(),this.indexPath_=e,p(!E(e)&&T(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){let i=this.extractChild(e.node),s=this.extractChild(n.node),r=i.compareTo(s);return r===0?kt(e.name,n.name):r}makePost(e,n){let i=Z(e),s=M.EMPTY_NODE.updateChild(this.indexPath_,i);return new C(n,s)}maxPost(){let e=M.EMPTY_NODE.updateChild(this.indexPath_,un);return new C(Ye,e)}toString(){return pu(this.indexPath_,0).join("/")}};var Ws=class extends Ct{compare(e,n){let i=e.node.compareTo(n.node);return i===0?kt(e.name,n.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return C.MIN}maxPost(){return C.MAX}makePost(e,n){let i=Z(e);return new C(n,i)}toString(){return".value"}},Xf=new Ws;function Zf(t){return{type:"value",snapshotNode:t}}function Jf(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function ep(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Nl(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function tp(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}var $s=class t{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=J}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return p(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return p(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Tt}hasEnd(){return this.endSet_}getIndexEndValue(){return p(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return p(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ye}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return p(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===J}copy(){let e=new t;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function Pl(t){let e={};if(t.isDefault())return e;let n;if(t.index_===J?n="$priority":t.index_===Xf?n="$value":t.index_===Et?n="$key":(p(t.index_ instanceof Bs,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=W(n),t.startSet_){let i=t.startAfterSet_?"startAfter":"startAt";e[i]=W(t.indexStartValue_),t.startNameSet_&&(e[i]+=","+W(t.indexStartName_))}if(t.endSet_){let i=t.endBeforeSet_?"endBefore":"endAt";e[i]=W(t.indexEndValue_),t.endNameSet_&&(e[i]+=","+W(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function Ol(t){let e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==J&&(e.i=t.index_.toString()),e}var js=class t extends ii{constructor(e,n,i,s){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=cn("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(p(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,n,i,s){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let o=t.getListenId_(e,i),a={};this.listens_[o]=a;let c=Pl(e._queryParams);this.restRequest_(r+".json",c,(l,h)=>{let u=h;if(l===404&&(u=null,l=null),l===null&&this.onDataUpdate_(r,u,!1,i),ze(this.listens_,o)===a){let d;l?l===401?d="permission_denied":d="rest_error:"+l:d="ok",s(d,null)}})}unlisten(e,n){let i=t.getListenId_(e,n);delete this.listens_[i]}get(e){let n=Pl(e._queryParams),i=e._path.toString(),s=new $i;return this.restRequest_(i+".json",n,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(i,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,n={},i){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(n.auth=s.accessToken),r&&r.token&&(n.ac=r.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Ka(n);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=On(a.responseText)}catch{le("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,c)}else a.status!==401&&a.status!==404&&le("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}};var zs=class{constructor(){this.rootNode_=M.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}};function ci(){return{value:null,children:new Map}}function Tu(t,e,n){if(E(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{let i=T(e);t.children.has(i)||t.children.set(i,ci());let s=t.children.get(i);e=k(e),Tu(s,e,n)}}function Vs(t,e,n){t.value!==null?n(e,t.value):np(t,(i,s)=>{let r=new A(e.toString()+"/"+i);Vs(s,r,n)})}function np(t,e){t.children.forEach((n,i)=>{e(i,n)})}var qs=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),n=Object.assign({},e);return this.last_&&_e(this.last_,(i,s)=>{n[i]=n[i]-s}),this.last_=e,n}};var xl=10*1e3,ip=30*1e3,sp=5*60*1e3,Hs=class{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new qs(e);let i=xl+(ip-xl)*Math.random();Jt(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){let e=this.statsListener_.get(),n={},i=!1;_e(e,(s,r)=>{r>0&&Re(this.statsToReport_,s)&&(n[s]=r,i=!0)}),i&&this.server_.reportStats(n),Jt(this.reportStats_.bind(this),Math.floor(Math.random()*2*sp))}};var Le=function(t){return t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",t}(Le||{});function Cu(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Su(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Iu(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}var Gs=class t{constructor(e,n,i){this.path=e,this.affectedTree=n,this.revert=i,this.type=Le.ACK_USER_WRITE,this.source=Cu()}operationForChild(e){if(E(this.path)){if(this.affectedTree.value!=null)return p(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let n=this.affectedTree.subtree(new A(e));return new t(b(),n,this.revert)}}else return p(T(this.path)===e,"operationForChild called for unrelated child."),new t(k(this.path),this.affectedTree,this.revert)}};var bt=class t{constructor(e,n,i){this.source=e,this.path=n,this.snap=i,this.type=Le.OVERWRITE}operationForChild(e){return E(this.path)?new t(this.source,b(),this.snap.getImmediateChild(e)):new t(this.source,k(this.path),this.snap)}};var li=class t{constructor(e,n,i){this.source=e,this.path=n,this.children=i,this.type=Le.MERGE}operationForChild(e){if(E(this.path)){let n=this.children.subtree(new A(e));return n.isEmpty()?null:n.value?new bt(this.source,b(),n.value):new t(this.source,b(),n)}else return p(T(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new t(this.source,k(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var sn=class{constructor(e,n,i){this.node_=e,this.fullyInitialized_=n,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(E(e))return this.isFullyInitialized()&&!this.filtered_;let n=T(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};function rp(t,e,n,i){let s=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(tp(o.childName,o.snapshotNode))}),Zt(t,s,"child_removed",e,i,n),Zt(t,s,"child_added",e,i,n),Zt(t,s,"child_moved",r,i,n),Zt(t,s,"child_changed",e,i,n),Zt(t,s,"value",e,i,n),s}function Zt(t,e,n,i,s,r){let o=i.filter(a=>a.type===n);o.sort((a,c)=>ap(t,a,c)),o.forEach(a=>{let c=op(t,a,r);s.forEach(l=>{l.respondsTo(a.type)&&e.push(l.createEvent(c,t.query_))})})}function op(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function ap(t,e,n){if(e.childName==null||n.childName==null)throw ot("Should only compare child_ events.");let i=new C(e.childName,e.snapshotNode),s=new C(n.childName,n.snapshotNode);return t.index_.compare(i,s)}function bu(t,e){return{eventCache:t,serverCache:e}}function tn(t,e,n,i){return bu(new sn(e,n,i),t.serverCache)}function Au(t,e,n,i){return bu(t.eventCache,new sn(e,n,i))}function Ks(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Qe(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}var gs,cp=()=>(gs||(gs=new pe(cf)),gs),ae=class t{constructor(e,n=cp()){this.value=e,this.children=n}static fromObject(e){let n=new t(null);return _e(e,(i,s)=>{n=n.set(new A(i),s)}),n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:b(),value:this.value};if(E(e))return null;{let i=T(e),s=this.children.get(i);if(s!==null){let r=s.findRootMostMatchingPathAndValue(k(e),n);return r!=null?{path:j(new A(i),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(E(e))return this;{let n=T(e),i=this.children.get(n);return i!==null?i.subtree(k(e)):new t(null)}}set(e,n){if(E(e))return new t(n,this.children);{let i=T(e),r=(this.children.get(i)||new t(null)).set(k(e),n),o=this.children.insert(i,r);return new t(this.value,o)}}remove(e){if(E(e))return this.children.isEmpty()?new t(null):new t(null,this.children);{let n=T(e),i=this.children.get(n);if(i){let s=i.remove(k(e)),r;return s.isEmpty()?r=this.children.remove(n):r=this.children.insert(n,s),this.value===null&&r.isEmpty()?new t(null):new t(this.value,r)}else return this}}get(e){if(E(e))return this.value;{let n=T(e),i=this.children.get(n);return i?i.get(k(e)):null}}setTree(e,n){if(E(e))return n;{let i=T(e),r=(this.children.get(i)||new t(null)).setTree(k(e),n),o;return r.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,r),new t(this.value,o)}}fold(e){return this.fold_(b(),e)}fold_(e,n){let i={};return this.children.inorderTraversal((s,r)=>{i[s]=r.fold_(j(e,s),n)}),n(e,this.value,i)}findOnPath(e,n){return this.findOnPath_(e,b(),n)}findOnPath_(e,n,i){let s=this.value?i(n,this.value):!1;if(s)return s;if(E(e))return null;{let r=T(e),o=this.children.get(r);return o?o.findOnPath_(k(e),j(n,r),i):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,b(),n)}foreachOnPath_(e,n,i){if(E(e))return this;{this.value&&i(n,this.value);let s=T(e),r=this.children.get(s);return r?r.foreachOnPath_(k(e),j(n,s),i):new t(null)}}foreach(e){this.foreach_(b(),e)}foreach_(e,n){this.children.inorderTraversal((i,s)=>{s.foreach_(j(e,i),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,i)=>{i.value&&e(n,i.value)})}};var we=class t{constructor(e){this.writeTree_=e}static empty(){return new t(new ae(null))}};function nn(t,e,n){if(E(e))return new we(new ae(n));{let i=t.writeTree_.findRootMostValueAndPath(e);if(i!=null){let s=i.path,r=i.value,o=fe(s,e);return r=r.updateChild(o,n),new we(t.writeTree_.set(s,r))}else{let s=new ae(n),r=t.writeTree_.setTree(e,s);return new we(r)}}}function Dl(t,e,n){let i=t;return _e(n,(s,r)=>{i=nn(i,j(e,s),r)}),i}function Ml(t,e){if(E(e))return we.empty();{let n=t.writeTree_.setTree(e,new ae(null));return new we(n)}}function Ys(t,e){return Xe(t,e)!=null}function Xe(t,e){let n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(fe(n.path,e)):null}function Ll(t){let e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(J,(i,s)=>{e.push(new C(i,s))}):t.writeTree_.children.inorderTraversal((i,s)=>{s.value!=null&&e.push(new C(i,s.value))}),e}function $e(t,e){if(E(e))return t;{let n=Xe(t,e);return n!=null?new we(new ae(n)):new we(t.writeTree_.subtree(e))}}function Qs(t){return t.writeTree_.isEmpty()}function At(t,e){return Ru(b(),t.writeTree_,e)}function Ru(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let i=null;return e.children.inorderTraversal((s,r)=>{s===".priority"?(p(r.value!==null,"Priority writes must always be leaf nodes"),i=r.value):n=Ru(j(t,s),r,n)}),!n.getChild(t).isEmpty()&&i!==null&&(n=n.updateChild(j(t,".priority"),i)),n}}function ku(t,e){return Du(e,t)}function lp(t,e,n,i,s){p(i>t.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),t.allWrites.push({path:e,snap:n,writeId:i,visible:s}),s&&(t.visibleWrites=nn(t.visibleWrites,e,n)),t.lastWriteId=i}function up(t,e){for(let n=0;n<t.allWrites.length;n++){let i=t.allWrites[n];if(i.writeId===e)return i}return null}function hp(t,e){let n=t.allWrites.findIndex(a=>a.writeId===e);p(n>=0,"removeWrite called with nonexistent writeId.");let i=t.allWrites[n];t.allWrites.splice(n,1);let s=i.visible,r=!1,o=t.allWrites.length-1;for(;s&&o>=0;){let a=t.allWrites[o];a.visible&&(o>=n&&dp(a,i.path)?s=!1:ve(i.path,a.path)&&(r=!0)),o--}if(s){if(r)return fp(t),!0;if(i.snap)t.visibleWrites=Ml(t.visibleWrites,i.path);else{let a=i.children;_e(a,c=>{t.visibleWrites=Ml(t.visibleWrites,j(i.path,c))})}return!0}else return!1}function dp(t,e){if(t.snap)return ve(t.path,e);for(let n in t.children)if(t.children.hasOwnProperty(n)&&ve(j(t.path,n),e))return!0;return!1}function fp(t){t.visibleWrites=Nu(t.allWrites,pp,b()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function pp(t){return t.visible}function Nu(t,e,n){let i=we.empty();for(let s=0;s<t.length;++s){let r=t[s];if(e(r)){let o=r.path,a;if(r.snap)ve(n,o)?(a=fe(n,o),i=nn(i,a,r.snap)):ve(o,n)&&(a=fe(o,n),i=nn(i,b(),r.snap.getChild(a)));else if(r.children){if(ve(n,o))a=fe(n,o),i=Dl(i,a,r.children);else if(ve(o,n))if(a=fe(o,n),E(a))i=Dl(i,b(),r.children);else{let c=ze(r.children,T(a));if(c){let l=c.getChild(k(a));i=nn(i,b(),l)}}}else throw ot("WriteRecord should have .snap or .children")}}return i}function Pu(t,e,n,i,s){if(!i&&!s){let r=Xe(t.visibleWrites,e);if(r!=null)return r;{let o=$e(t.visibleWrites,e);if(Qs(o))return n;if(n==null&&!Ys(o,b()))return null;{let a=n||M.EMPTY_NODE;return At(o,a)}}}else{let r=$e(t.visibleWrites,e);if(!s&&Qs(r))return n;if(!s&&n==null&&!Ys(r,b()))return null;{let o=function(l){return(l.visible||s)&&(!i||!~i.indexOf(l.writeId))&&(ve(l.path,e)||ve(e,l.path))},a=Nu(t.allWrites,o,e),c=n||M.EMPTY_NODE;return At(a,c)}}}function _p(t,e,n){let i=M.EMPTY_NODE,s=Xe(t.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(J,(r,o)=>{i=i.updateImmediateChild(r,o)}),i;if(n){let r=$e(t.visibleWrites,e);return n.forEachChild(J,(o,a)=>{let c=At($e(r,new A(o)),a);i=i.updateImmediateChild(o,c)}),Ll(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{let r=$e(t.visibleWrites,e);return Ll(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function mp(t,e,n,i,s){p(i||s,"Either existingEventSnap or existingServerSnap must exist");let r=j(e,n);if(Ys(t.visibleWrites,r))return null;{let o=$e(t.visibleWrites,r);return Qs(o)?s.getChild(n):At(o,s.getChild(n))}}function gp(t,e,n,i){let s=j(e,n),r=Xe(t.visibleWrites,s);if(r!=null)return r;if(i.isCompleteForChild(n)){let o=$e(t.visibleWrites,s);return At(o,i.getNode().getImmediateChild(n))}else return null}function yp(t,e){return Xe(t.visibleWrites,e)}function vp(t,e,n,i,s,r,o){let a,c=$e(t.visibleWrites,e),l=Xe(c,b());if(l!=null)a=l;else if(n!=null)a=At(c,n);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let h=[],u=o.getCompare(),d=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),_=d.getNext();for(;_&&h.length<s;)u(_,i)!==0&&h.push(_),_=d.getNext();return h}else return[]}function wp(){return{visibleWrites:we.empty(),allWrites:[],lastWriteId:-1}}function Xs(t,e,n,i){return Pu(t.writeTree,t.treePath,e,n,i)}function Ou(t,e){return _p(t.writeTree,t.treePath,e)}function Fl(t,e,n,i){return mp(t.writeTree,t.treePath,e,n,i)}function ui(t,e){return yp(t.writeTree,j(t.treePath,e))}function Ep(t,e,n,i,s,r){return vp(t.writeTree,t.treePath,e,n,i,s,r)}function _r(t,e,n){return gp(t.writeTree,t.treePath,e,n)}function xu(t,e){return Du(j(t.treePath,e),t.writeTree)}function Du(t,e){return{treePath:t,writeTree:e}}var Zs=class{constructor(){this.changeMap=new Map}trackChildChange(e){let n=e.type,i=e.childName;p(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),p(i!==".priority","Only non-priority child changes can be tracked.");let s=this.changeMap.get(i);if(s){let r=s.type;if(n==="child_added"&&r==="child_removed")this.changeMap.set(i,Nl(i,e.snapshotNode,s.snapshotNode));else if(n==="child_removed"&&r==="child_added")this.changeMap.delete(i);else if(n==="child_removed"&&r==="child_changed")this.changeMap.set(i,ep(i,s.oldSnap));else if(n==="child_changed"&&r==="child_added")this.changeMap.set(i,Jf(i,e.snapshotNode));else if(n==="child_changed"&&r==="child_changed")this.changeMap.set(i,Nl(i,e.snapshotNode,s.oldSnap));else throw ot("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}};var Js=class{getCompleteChild(e){return null}getChildAfterChild(e,n,i){return null}},Mu=new Js,rn=class{constructor(e,n,i=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=i}getCompleteChild(e){let n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{let i=this.optCompleteServerCache_!=null?new sn(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return _r(this.writes_,e,i)}}getChildAfterChild(e,n,i){let s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Qe(this.viewCache_),r=Ep(this.writes_,s,n,1,i,e);return r.length===0?null:r[0]}};function Tp(t,e){p(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),p(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function Cp(t,e,n,i,s){let r=new Zs,o,a;if(n.type===Le.OVERWRITE){let l=n;l.source.fromUser?o=er(t,e,l.path,l.snap,i,s,r):(p(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered()&&!E(l.path),o=hi(t,e,l.path,l.snap,i,s,a,r))}else if(n.type===Le.MERGE){let l=n;l.source.fromUser?o=Ip(t,e,l.path,l.children,i,s,r):(p(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered(),o=tr(t,e,l.path,l.children,i,s,a,r))}else if(n.type===Le.ACK_USER_WRITE){let l=n;l.revert?o=Rp(t,e,l.path,i,s,r):o=bp(t,e,l.path,l.affectedTree,i,s,r)}else if(n.type===Le.LISTEN_COMPLETE)o=Ap(t,e,n.path,i,r);else throw ot("Unknown operation type: "+n.type);let c=r.getChanges();return Sp(e,o,c),{viewCache:o,changes:c}}function Sp(t,e,n){let i=e.eventCache;if(i.isFullyInitialized()){let s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=Ks(t);(n.length>0||!t.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&n.push(Zf(Ks(e)))}}function Lu(t,e,n,i,s,r){let o=e.eventCache;if(ui(i,n)!=null)return e;{let a,c;if(E(n))if(p(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let l=Qe(e),h=l instanceof M?l:M.EMPTY_NODE,u=Ou(i,h);a=t.filter.updateFullNode(e.eventCache.getNode(),u,r)}else{let l=Xs(i,Qe(e));a=t.filter.updateFullNode(e.eventCache.getNode(),l,r)}else{let l=T(n);if(l===".priority"){p(je(n)===1,"Can't have a priority with additional path components");let h=o.getNode();c=e.serverCache.getNode();let u=Fl(i,n,h,c);u!=null?a=t.filter.updatePriority(h,u):a=o.getNode()}else{let h=k(n),u;if(o.isCompleteForChild(l)){c=e.serverCache.getNode();let d=Fl(i,n,o.getNode(),c);d!=null?u=o.getNode().getImmediateChild(l).updateChild(h,d):u=o.getNode().getImmediateChild(l)}else u=_r(i,l,e.serverCache);u!=null?a=t.filter.updateChild(o.getNode(),l,u,h,s,r):a=o.getNode()}}return tn(e,a,o.isFullyInitialized()||E(n),t.filter.filtersNodes())}}function hi(t,e,n,i,s,r,o,a){let c=e.serverCache,l,h=o?t.filter:t.filter.getIndexedFilter();if(E(n))l=h.updateFullNode(c.getNode(),i,null);else if(h.filtersNodes()&&!c.isFiltered()){let _=c.getNode().updateChild(n,i);l=h.updateFullNode(c.getNode(),_,null)}else{let _=T(n);if(!c.isCompleteForPath(n)&&je(n)>1)return e;let f=k(n),w=c.getNode().getImmediateChild(_).updateChild(f,i);_===".priority"?l=h.updatePriority(c.getNode(),w):l=h.updateChild(c.getNode(),_,w,f,Mu,null)}let u=Au(e,l,c.isFullyInitialized()||E(n),h.filtersNodes()),d=new rn(s,u,r);return Lu(t,u,n,s,d,a)}function er(t,e,n,i,s,r,o){let a=e.eventCache,c,l,h=new rn(s,e,r);if(E(n))l=t.filter.updateFullNode(e.eventCache.getNode(),i,o),c=tn(e,l,!0,t.filter.filtersNodes());else{let u=T(n);if(u===".priority")l=t.filter.updatePriority(e.eventCache.getNode(),i),c=tn(e,l,a.isFullyInitialized(),a.isFiltered());else{let d=k(n),_=a.getNode().getImmediateChild(u),f;if(E(d))f=i;else{let m=h.getCompleteChild(u);m!=null?fu(d)===".priority"&&m.getChild(_u(d)).isEmpty()?f=m:f=m.updateChild(d,i):f=M.EMPTY_NODE}if(_.equals(f))c=e;else{let m=t.filter.updateChild(a.getNode(),u,f,d,h,o);c=tn(e,m,a.isFullyInitialized(),t.filter.filtersNodes())}}}return c}function Ul(t,e){return t.eventCache.isCompleteForChild(e)}function Ip(t,e,n,i,s,r,o){let a=e;return i.foreach((c,l)=>{let h=j(n,c);Ul(e,T(h))&&(a=er(t,a,h,l,s,r,o))}),i.foreach((c,l)=>{let h=j(n,c);Ul(e,T(h))||(a=er(t,a,h,l,s,r,o))}),a}function Bl(t,e,n){return n.foreach((i,s)=>{e=e.updateChild(i,s)}),e}function tr(t,e,n,i,s,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,l;E(n)?l=i:l=new ae(null).setTree(n,i);let h=e.serverCache.getNode();return l.children.inorderTraversal((u,d)=>{if(h.hasChild(u)){let _=e.serverCache.getNode().getImmediateChild(u),f=Bl(t,_,d);c=hi(t,c,new A(u),f,s,r,o,a)}}),l.children.inorderTraversal((u,d)=>{let _=!e.serverCache.isCompleteForChild(u)&&d.value===null;if(!h.hasChild(u)&&!_){let f=e.serverCache.getNode().getImmediateChild(u),m=Bl(t,f,d);c=hi(t,c,new A(u),m,s,r,o,a)}}),c}function bp(t,e,n,i,s,r,o){if(ui(s,n)!=null)return e;let a=e.serverCache.isFiltered(),c=e.serverCache;if(i.value!=null){if(E(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return hi(t,e,n,c.getNode().getChild(n),s,r,a,o);if(E(n)){let l=new ae(null);return c.getNode().forEachChild(Et,(h,u)=>{l=l.set(new A(h),u)}),tr(t,e,n,l,s,r,a,o)}else return e}else{let l=new ae(null);return i.foreach((h,u)=>{let d=j(n,h);c.isCompleteForPath(d)&&(l=l.set(h,c.getNode().getChild(d)))}),tr(t,e,n,l,s,r,a,o)}}function Ap(t,e,n,i,s){let r=e.serverCache,o=Au(e,r.getNode(),r.isFullyInitialized()||E(n),r.isFiltered());return Lu(t,o,n,i,Mu,s)}function Rp(t,e,n,i,s,r){let o;if(ui(i,n)!=null)return e;{let a=new rn(i,e,s),c=e.eventCache.getNode(),l;if(E(n)||T(n)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=Xs(i,Qe(e));else{let u=e.serverCache.getNode();p(u instanceof M,"serverChildren would be complete if leaf node"),h=Ou(i,u)}h=h,l=t.filter.updateFullNode(c,h,r)}else{let h=T(n),u=_r(i,h,e.serverCache);u==null&&e.serverCache.isCompleteForChild(h)&&(u=c.getImmediateChild(h)),u!=null?l=t.filter.updateChild(c,h,u,k(n),a,r):e.eventCache.getNode().hasChild(h)?l=t.filter.updateChild(c,h,M.EMPTY_NODE,k(n),a,r):l=c,l.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Xs(i,Qe(e)),o.isLeafNode()&&(l=t.filter.updateFullNode(l,o,r)))}return o=e.serverCache.isFullyInitialized()||ui(i,b())!=null,tn(e,l,o,t.filter.filtersNodes())}}function kp(t,e){let n=Qe(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!E(e)&&!n.getImmediateChild(T(e)).isEmpty())?n.getChild(e):null}function Wl(t,e,n,i){e.type===Le.MERGE&&e.source.queryId!==null&&(p(Qe(t.viewCache_),"We should always have a full cache before handling merges"),p(Ks(t.viewCache_),"Missing event cache, even though we have a server cache"));let s=t.viewCache_,r=Cp(t.processor_,s,e,n,i);return Tp(t.processor_,r.viewCache),p(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=r.viewCache,Np(t,r.changes,r.viewCache.eventCache.getNode(),null)}function Np(t,e,n,i){let s=i?[i]:t.eventRegistrations_;return rp(t.eventGenerator_,e,n,s)}var $l;function Pp(t){p(!$l,"__referenceConstructor has already been defined"),$l=t}function mr(t,e,n,i){let s=e.source.queryId;if(s!==null){let r=t.views.get(s);return p(r!=null,"SyncTree gave us an op for an invalid query."),Wl(r,e,n,i)}else{let r=[];for(let o of t.views.values())r=r.concat(Wl(o,e,n,i));return r}}function gr(t,e){let n=null;for(let i of t.views.values())n=n||kp(i,e);return n}var jl;function Op(t){p(!jl,"__referenceConstructor has already been defined"),jl=t}var di=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ae(null),this.pendingWriteTree_=wp(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function xp(t,e,n,i,s){return lp(t.pendingWriteTree_,e,n,i,s),s?pi(t,new bt(Cu(),e,n)):[]}function vt(t,e,n=!1){let i=up(t.pendingWriteTree_,e);if(hp(t.pendingWriteTree_,e)){let r=new ae(null);return i.snap!=null?r=r.set(b(),!0):_e(i.children,o=>{r=r.set(new A(o),!0)}),pi(t,new Gs(i.path,r,n))}else return[]}function fi(t,e,n){return pi(t,new bt(Su(),e,n))}function Dp(t,e,n){let i=ae.fromObject(n);return pi(t,new li(Su(),e,i))}function Mp(t,e,n,i){let s=Wu(t,i);if(s!=null){let r=$u(s),o=r.path,a=r.queryId,c=fe(o,e),l=new bt(Iu(a),c,n);return ju(t,o,l)}else return[]}function Lp(t,e,n,i){let s=Wu(t,i);if(s){let r=$u(s),o=r.path,a=r.queryId,c=fe(o,e),l=ae.fromObject(n),h=new li(Iu(a),c,l);return ju(t,o,h)}else return[]}function Fu(t,e,n){let s=t.pendingWriteTree_,r=t.syncPointTree_.findOnPath(e,(o,a)=>{let c=fe(o,e),l=gr(a,c);if(l)return l});return Pu(s,e,r,n,!0)}function pi(t,e){return Uu(e,t.syncPointTree_,null,ku(t.pendingWriteTree_,b()))}function Uu(t,e,n,i){if(E(t.path))return Bu(t,e,n,i);{let s=e.get(b());n==null&&s!=null&&(n=gr(s,b()));let r=[],o=T(t.path),a=t.operationForChild(o),c=e.children.get(o);if(c&&a){let l=n?n.getImmediateChild(o):null,h=xu(i,o);r=r.concat(Uu(a,c,l,h))}return s&&(r=r.concat(mr(s,t,i,n))),r}}function Bu(t,e,n,i){let s=e.get(b());n==null&&s!=null&&(n=gr(s,b()));let r=[];return e.children.inorderTraversal((o,a)=>{let c=n?n.getImmediateChild(o):null,l=xu(i,o),h=t.operationForChild(o);h&&(r=r.concat(Bu(h,a,c,l)))}),s&&(r=r.concat(mr(s,t,i,n))),r}function Wu(t,e){return t.tagToQueryMap.get(e)}function $u(t){let e=t.indexOf("$");return p(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new A(t.substr(0,e))}}function ju(t,e,n){let i=t.syncPointTree_.get(e);p(i,"Missing sync point for query tag that we're tracking");let s=ku(t.pendingWriteTree_,e);return mr(i,n,s,null)}var nr=class t{constructor(e){this.node_=e}getImmediateChild(e){let n=this.node_.getImmediateChild(e);return new t(n)}node(){return this.node_}},ir=class t{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){let n=j(this.path_,e);return new t(this.syncTree_,n)}node(){return Fu(this.syncTree_,this.path_)}},Fp=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},zl=function(t,e,n){if(!t||typeof t!="object")return t;if(p(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return Up(t[".sv"],e,n);if(typeof t[".sv"]=="object")return Bp(t[".sv"],e);p(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},Up=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:p(!1,"Unexpected server value: "+t)}},Bp=function(t,e,n){t.hasOwnProperty("increment")||p(!1,"Unexpected server value: "+JSON.stringify(t,null,2));let i=t.increment;typeof i!="number"&&p(!1,"Unexpected increment value: "+i);let s=e.node();if(p(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;let o=s.getValue();return typeof o!="number"?i:o+i},Wp=function(t,e,n,i){return yr(e,new ir(n,t),i)},$p=function(t,e,n){return yr(t,new nr(e),n)};function yr(t,e,n){let i=t.getPriority().val(),s=zl(i,e.getImmediateChild(".priority"),n),r;if(t.isLeafNode()){let o=t,a=zl(o.getValue(),e,n);return a!==o.getValue()||s!==o.getPriority().val()?new St(a,Z(s)):t}else{let o=t;return r=o,s!==o.getPriority().val()&&(r=r.updatePriority(new St(s))),o.forEachChild(J,(a,c)=>{let l=yr(c,e.getImmediateChild(a),n);l!==c&&(r=r.updateImmediateChild(a,l))}),r}}var on=class{constructor(e="",n=null,i={children:{},childCount:0}){this.name=e,this.parent=n,this.node=i}};function vr(t,e){let n=e instanceof A?e:new A(e),i=t,s=T(n);for(;s!==null;){let r=ze(i.node.children,s)||{children:{},childCount:0};i=new on(s,i,r),n=k(n),s=T(n)}return i}function Nt(t){return t.node.value}function zu(t,e){t.node.value=e,sr(t)}function Vu(t){return t.node.childCount>0}function jp(t){return Nt(t)===void 0&&!Vu(t)}function _i(t,e){_e(t.node.children,(n,i)=>{e(new on(n,t,i))})}function qu(t,e,n,i){n&&!i&&e(t),_i(t,s=>{qu(s,e,!0,i)}),n&&i&&e(t)}function zp(t,e,n){let i=n?t:t.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function hn(t){return new A(t.parent===null?t.name:hn(t.parent)+"/"+t.name)}function sr(t){t.parent!==null&&Vp(t.parent,t.name,t)}function Vp(t,e,n){let i=jp(n),s=Re(t.node.children,e);i&&s?(delete t.node.children[e],t.node.childCount--,sr(t)):!i&&!s&&(t.node.children[e]=n.node,t.node.childCount++,sr(t))}var qp=/[\[\].#$\/\u0000-\u001F\u007F]/,Hp=/[\[\].#$\u0000-\u001F\u007F]/,ys=10*1024*1024,Hu=function(t){return typeof t=="string"&&t.length!==0&&!qp.test(t)},Gp=function(t){return typeof t=="string"&&t.length!==0&&!Hp.test(t)},Kp=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Gp(t)};var Gu=function(t,e,n){let i=n instanceof A?new Os(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+He(i));if(typeof e=="function")throw new Error(t+"contains a function "+He(i)+" with contents = "+e.toString());if(Yl(e))throw new Error(t+"contains "+e.toString()+" "+He(i));if(typeof e=="string"&&e.length>ys/3&&Ut(e)>ys)throw new Error(t+"contains a string greater than "+ys+" utf8 bytes "+He(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,r=!1;if(_e(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!Hu(o)))throw new Error(t+" contains an invalid key ("+o+") "+He(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Bf(i,o),Gu(t,a,i),Wf(i)}),s&&r)throw new Error(t+' contains ".value" child '+He(i)+" in addition to actual children.")}};var Yp=function(t,e){let n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Hu(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!Kp(n))throw new Error(Qa(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var rr=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function Qp(t,e){let n=null;for(let i=0;i<e.length;i++){let s=e[i],r=s.getPath();n!==null&&!mu(r,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:r}),n.events.push(s)}n&&t.eventLists_.push(n)}function Ze(t,e,n){Qp(t,n),Xp(t,i=>ve(i,e)||ve(e,i))}function Xp(t,e){t.recursionDepth_++;let n=!0;for(let i=0;i<t.eventLists_.length;i++){let s=t.eventLists_[i];if(s){let r=s.path;e(r)?(Zp(t.eventLists_[i]),t.eventLists_[i]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function Zp(t){for(let e=0;e<t.events.length;e++){let n=t.events[e];if(n!==null){t.events[e]=null;let i=n.getEventRunner();Ke&&X("event: "+n.toString()),ln(i)}}}var Jp="repo_interrupt",e_=25,or=class{constructor(e,n,i,s){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new rr,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=ci(),this.transactionQueueTree_=new on,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function t_(t,e,n){if(t.stats_=dr(t.repoInfo_),t.forceRestClient_||pf())t.server_=new js(t.repoInfo_,(i,s,r,o)=>{Vl(t,i,s,r,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>ql(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{W(n)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}t.persistentConnection_=new fr(t.repoInfo_,e,(i,s,r,o)=>{Vl(t,i,s,r,o)},i=>{ql(t,i)},i=>{i_(t,i)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(i=>{t.server_.refreshAuthToken(i)}),t.appCheckProvider_.addTokenChangeListener(i=>{t.server_.refreshAppCheckToken(i.token)}),t.statsReporter_=mf(t.repoInfo_,()=>new Hs(t.stats_,t.server_)),t.infoData_=new zs,t.infoSyncTree_=new di({startListening:(i,s,r,o)=>{let a=[],c=t.infoData_.getNode(i._path);return c.isEmpty()||(a=fi(t.infoSyncTree_,i._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),wr(t,"connected",!1),t.serverSyncTree_=new di({startListening:(i,s,r,o)=>(t.server_.listen(i,r,s,(a,c)=>{let l=o(a,c);Ze(t.eventQueue_,i._path,l)}),[]),stopListening:(i,s)=>{t.server_.unlisten(i,s)}})}function n_(t){let n=t.infoData_.getNode(new A(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function Ku(t){return Fp({timestamp:n_(t)})}function Vl(t,e,n,i,s){t.dataUpdateCount++;let r=new A(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(s)if(i){let c=Ft(n,l=>Z(l));o=Lp(t.serverSyncTree_,r,c,s)}else{let c=Z(n);o=Mp(t.serverSyncTree_,r,c,s)}else if(i){let c=Ft(n,l=>Z(l));o=Dp(t.serverSyncTree_,r,c)}else{let c=Z(n);o=fi(t.serverSyncTree_,r,c)}let a=r;o.length>0&&(a=Tr(t,r)),Ze(t.eventQueue_,a,o)}function ql(t,e){wr(t,"connected",e),e===!1&&r_(t)}function i_(t,e){_e(e,(n,i)=>{wr(t,n,i)})}function wr(t,e,n){let i=new A("/.info/"+e),s=Z(n);t.infoData_.updateSnapshot(i,s);let r=fi(t.infoSyncTree_,i,s);Ze(t.eventQueue_,i,r)}function s_(t){return t.nextWriteId_++}function r_(t){Yu(t,"onDisconnectEvents");let e=Ku(t),n=ci();Vs(t.onDisconnect_,b(),(s,r)=>{let o=Wp(s,r,t.serverSyncTree_,e);Tu(n,s,o)});let i=[];Vs(n,b(),(s,r)=>{i=i.concat(fi(t.serverSyncTree_,s,r));let o=l_(t,s);Tr(t,o)}),t.onDisconnect_=ci(),Ze(t.eventQueue_,b(),i)}function o_(t){t.persistentConnection_&&t.persistentConnection_.interrupt(Jp)}function Yu(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),X(n,...e)}function Qu(t,e,n){return Fu(t.serverSyncTree_,e,n)||M.EMPTY_NODE}function Er(t,e=t.transactionQueueTree_){if(e||mi(t,e),Nt(e)){let n=Zu(t,e);p(n.length>0,"Sending zero length transaction queue"),n.every(s=>s.status===0)&&a_(t,hn(e),n)}else Vu(e)&&_i(e,n=>{Er(t,n)})}function a_(t,e,n){let i=n.map(l=>l.currentWriteId),s=Qu(t,e,i),r=s,o=s.hash();for(let l=0;l<n.length;l++){let h=n[l];p(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;let u=fe(e,h.path);r=r.updateChild(u,h.currentOutputSnapshotRaw)}let a=r.val(!0),c=e;t.server_.put(c.toString(),a,l=>{Yu(t,"transaction put response",{path:c.toString(),status:l});let h=[];if(l==="ok"){let u=[];for(let d=0;d<n.length;d++)n[d].status=2,h=h.concat(vt(t.serverSyncTree_,n[d].currentWriteId)),n[d].onComplete&&u.push(()=>n[d].onComplete(null,!0,n[d].currentOutputSnapshotResolved)),n[d].unwatcher();mi(t,vr(t.transactionQueueTree_,e)),Er(t,t.transactionQueueTree_),Ze(t.eventQueue_,e,h);for(let d=0;d<u.length;d++)ln(u[d])}else{if(l==="datastale")for(let u=0;u<n.length;u++)n[u].status===3?n[u].status=4:n[u].status=0;else{le("transaction at "+c.toString()+" failed: "+l);for(let u=0;u<n.length;u++)n[u].status=4,n[u].abortReason=l}Tr(t,e)}},o)}function Tr(t,e){let n=Xu(t,e),i=hn(n),s=Zu(t,n);return c_(t,s,i),i}function c_(t,e,n){if(e.length===0)return;let i=[],s=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let c=e[a],l=fe(n,c.path),h=!1,u;if(p(l!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)h=!0,u=c.abortReason,s=s.concat(vt(t.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=e_)h=!0,u="maxretry",s=s.concat(vt(t.serverSyncTree_,c.currentWriteId,!0));else{let d=Qu(t,c.path,o);c.currentInputSnapshot=d;let _=e[a].update(d.val());if(_!==void 0){Gu("transaction failed: Data returned ",_,c.path);let f=Z(_);typeof _=="object"&&_!=null&&Re(_,".priority")||(f=f.updatePriority(d.getPriority()));let w=c.currentWriteId,N=Ku(t),z=$p(f,d,N);c.currentOutputSnapshotRaw=f,c.currentOutputSnapshotResolved=z,c.currentWriteId=s_(t),o.splice(o.indexOf(w),1),s=s.concat(xp(t.serverSyncTree_,c.path,z,c.currentWriteId,c.applyLocally)),s=s.concat(vt(t.serverSyncTree_,w,!0))}else h=!0,u="nodata",s=s.concat(vt(t.serverSyncTree_,c.currentWriteId,!0))}Ze(t.eventQueue_,n,s),s=[],h&&(e[a].status=2,function(d){setTimeout(d,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(u==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(u),!1,null))))}mi(t,t.transactionQueueTree_);for(let a=0;a<i.length;a++)ln(i[a]);Er(t,t.transactionQueueTree_)}function Xu(t,e){let n,i=t.transactionQueueTree_;for(n=T(e);n!==null&&Nt(i)===void 0;)i=vr(i,n),e=k(e),n=T(e);return i}function Zu(t,e){let n=[];return Ju(t,e,n),n.sort((i,s)=>i.order-s.order),n}function Ju(t,e,n){let i=Nt(e);if(i)for(let s=0;s<i.length;s++)n.push(i[s]);_i(e,s=>{Ju(t,s,n)})}function mi(t,e){let n=Nt(e);if(n){let i=0;for(let s=0;s<n.length;s++)n[s].status!==2&&(n[i]=n[s],i++);n.length=i,zu(e,n.length>0?n:void 0)}_i(e,i=>{mi(t,i)})}function l_(t,e){let n=hn(Xu(t,e)),i=vr(t.transactionQueueTree_,e);return zp(i,s=>{vs(t,s)}),vs(t,i),qu(i,s=>{vs(t,s)}),n}function vs(t,e){let n=Nt(e);if(n){let i=[],s=[],r=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(p(r===o-1,"All SENT items should be at beginning of queue."),r=o,n[o].status=3,n[o].abortReason="set"):(p(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),s=s.concat(vt(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&i.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?zu(e,void 0):n.length=r+1,Ze(t.eventQueue_,hn(e),s);for(let o=0;o<i.length;o++)ln(i[o])}}function u_(t){let e="",n=t.split("/");for(let i=0;i<n.length;i++)if(n[i].length>0){let s=n[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function h_(t){let e={};t.charAt(0)==="?"&&(t=t.substring(1));for(let n of t.split("&")){if(n.length===0)continue;let i=n.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):le(`Invalid query segment '${n}' in query '${t}'`)}return e}var Hl=function(t,e){let n=d_(t),i=n.namespace;n.domain==="firebase.com"&&Fe(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&n.domain!=="localhost"&&Fe("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||of();let s=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new ti(n.host,n.secure,i,s,e,"",i!==n.subdomain),path:new A(n.pathString)}},d_=function(t){let e="",n="",i="",s="",r="",o=!0,a="https",c=443;if(typeof t=="string"){let l=t.indexOf("//");l>=0&&(a=t.substring(0,l-1),t=t.substring(l+2));let h=t.indexOf("/");h===-1&&(h=t.length);let u=t.indexOf("?");u===-1&&(u=t.length),e=t.substring(0,Math.min(h,u)),h<u&&(s=u_(t.substring(h,u)));let d=h_(t.substring(Math.min(t.length,u)));l=e.indexOf(":"),l>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(l+1),10)):l=e.length;let _=e.slice(0,l);if(_.toLowerCase()==="localhost")n="localhost";else if(_.split(".").length<=2)n=_;else{let f=e.indexOf(".");i=e.substring(0,f).toLowerCase(),n=e.substring(f+1),r=i}"ns"in d&&(r=d.ns)}return{host:e,port:c,domain:n,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}};var ar=class t{constructor(e,n,i,s){this._repo=e,this._path=n,this._queryParams=i,this._orderByCalled=s}get key(){return E(this._path)?null:fu(this._path)}get ref(){return new Rt(this._repo,this._path)}get _queryIdentifier(){let e=Ol(this._queryParams),n=hr(e);return n==="{}"?"default":n}get _queryObject(){return Ol(this._queryParams)}isEqual(e){if(e=Ve(e),!(e instanceof t))return!1;let n=this._repo===e._repo,i=mu(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return n&&i&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+Uf(this._path)}};var Rt=class t extends ar{constructor(e,n){super(e,n,new $s,!1)}get parent(){let e=_u(this._path);return e===null?null:new t(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}};Pp(Rt);Op(Rt);var f_="FIREBASE_DATABASE_EMULATOR_HOST",cr={},p_=!1;function __(t,e,n,i){t.repoInfo_=new ti(`${e}:${n}`,!1,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0),i&&(t.authTokenProvider_=i)}function m_(t,e,n,i,s){let r=i||t.options.databaseURL;r===void 0&&(t.options.projectId||Fe("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),X("Using default host for project ",t.options.projectId),r=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=Hl(r,s),a=o.repoInfo,c,l;typeof process<"u"&&process.env&&(l=process.env[f_]),l?(c=!0,r=`http://${l}?ns=${a.namespace}`,o=Hl(r,s),a=o.repoInfo):c=!o.repoInfo.secure;let h=s&&c?new en(en.OWNER):new Is(t.name,t.options,e);Yp("Invalid Firebase Database URL",o),E(o.path)||Fe("Database URL must point to the root of a Firebase Database (not including a child path).");let u=y_(a,t,h,new Ss(t.name,n));return new lr(u,t)}function g_(t,e){let n=cr[e];(!n||n[t.key]!==t)&&Fe(`Database ${e}(${t.repoInfo_}) has already been deleted.`),o_(t),delete n[t.key]}function y_(t,e,n,i){let s=cr[e.name];s||(s={},cr[e.name]=s);let r=s[t.toURLString()];return r&&Fe("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new or(t,p_,n,i),s[t.toURLString()]=r,r}var lr=class{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(t_(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Rt(this._repo,b())),this._rootInternal}_delete(){return this._rootInternal!==null&&(g_(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Fe("Cannot call "+e+" on a deleted database.")}};function eh(t=qe(),e){let n=Me(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){let i=Rn("database");i&&th(n,...i)}return n}function th(t,e,n,i={}){t=Ve(t),t._checkNotDeleted("useEmulator"),t._instanceStarted&&Fe("Cannot call useEmulator() after instance has already been initialized.");let s=t._repoInternal,r;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&Fe('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new en(en.OWNER);else if(i.mockUserToken){let o=typeof i.mockUserToken=="string"?i.mockUserToken:kn(i.mockUserToken,t.app.options.projectId);r=new en(o)}__(s,e,n,r)}function v_(t){nf(Dn),Ne(new ke("database",(e,{instanceIdentifier:n})=>{let i=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return m_(i,s,r,n)},"PUBLIC").setMultipleInstances(!0)),$(pl,_l,t),$(pl,_l,"esm2017")}fr.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};fr.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};v_();var dn=class{constructor(e){return e}},nh="database",Cr=class{constructor(){return lt(nh)}};var Sr=new re("angularfire2.database-instances");function w_(t,e){let n=ct(nh,t,e);return n&&new dn(n)}function E_(t){return(e,n)=>{let i=e.runOutsideAngular(()=>t(n));return new dn(i)}}var T_={provide:Cr,deps:[[new ce,Sr]]},C_={provide:dn,useFactory:w_,deps:[[new ce,Sr],dt]};function ih(t,...e){return $("angularfire",at.full,"rtdb"),ue([C_,T_,{provide:Sr,useFactory:E_(t),multi:!0,deps:[Se,it,ut,ft,[new ce,Ln],[new ce,Mn],...e]}])}var sh=ht(eh,!0);var ah="@firebase/installations",Rr="0.6.9";var ch=1e4,lh=`w:${Rr}`,uh="FIS_v2",S_="https://firebaseinstallations.googleapis.com/v1",I_=60*60*1e3,b_="installations",A_="Installations";var R_={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},et=new Pn(b_,A_,R_);function hh(t){return t instanceof Nn&&t.code.includes("request-failed")}function dh({projectId:t}){return`${S_}/projects/${t}/installations`}function fh(t){return{token:t.token,requestStatus:2,expiresIn:N_(t.expiresIn),creationTime:Date.now()}}function ph(t,e){return g(this,null,function*(){let i=(yield e.json()).error;return et.create("request-failed",{requestName:t,serverCode:i.code,serverMessage:i.message,serverStatus:i.status})})}function _h({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function k_(t,{refreshToken:e}){let n=_h(t);return n.append("Authorization",P_(e)),n}function mh(t){return g(this,null,function*(){let e=yield t();return e.status>=500&&e.status<600?t():e})}function N_(t){return Number(t.replace("s","000"))}function P_(t){return`${uh} ${t}`}function O_(i,s){return g(this,arguments,function*({appConfig:t,heartbeatServiceProvider:e},{fid:n}){let r=dh(t),o=_h(t),a=e.getImmediate({optional:!0});if(a){let u=yield a.getHeartbeatsHeader();u&&o.append("x-firebase-client",u)}let c={fid:n,authVersion:uh,appId:t.appId,sdkVersion:lh},l={method:"POST",headers:o,body:JSON.stringify(c)},h=yield mh(()=>fetch(r,l));if(h.ok){let u=yield h.json();return{fid:u.fid||n,registrationStatus:2,refreshToken:u.refreshToken,authToken:fh(u.authToken)}}else throw yield ph("Create Installation",h)})}function gh(t){return new Promise(e=>{setTimeout(e,t)})}function x_(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}var D_=/^[cdef][\w-]{21}$/,Ar="";function M_(){try{let t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;let n=L_(t);return D_.test(n)?n:Ar}catch{return Ar}}function L_(t){return x_(t).substr(0,22)}function yi(t){return`${t.appName}!${t.appId}`}var yh=new Map;function vh(t,e){let n=yi(t);wh(n,e),F_(n,e)}function wh(t,e){let n=yh.get(t);if(n)for(let i of n)i(e)}function F_(t,e){let n=U_();n&&n.postMessage({key:t,fid:e}),B_()}var Je=null;function U_(){return!Je&&"BroadcastChannel"in self&&(Je=new BroadcastChannel("[Firebase] FID Change"),Je.onmessage=t=>{wh(t.data.key,t.data.fid)}),Je}function B_(){yh.size===0&&Je&&(Je.close(),Je=null)}var W_="firebase-installations-database",$_=1,tt="firebase-installations-store",Ir=null;function kr(){return Ir||(Ir=Bt(W_,$_,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(tt)}}})),Ir}function gi(t,e){return g(this,null,function*(){let n=yi(t),s=(yield kr()).transaction(tt,"readwrite"),r=s.objectStore(tt),o=yield r.get(n);return yield r.put(e,n),yield s.done,(!o||o.fid!==e.fid)&&vh(t,e.fid),e})}function Eh(t){return g(this,null,function*(){let e=yi(t),i=(yield kr()).transaction(tt,"readwrite");yield i.objectStore(tt).delete(e),yield i.done})}function vi(t,e){return g(this,null,function*(){let n=yi(t),s=(yield kr()).transaction(tt,"readwrite"),r=s.objectStore(tt),o=yield r.get(n),a=e(o);return a===void 0?yield r.delete(n):yield r.put(a,n),yield s.done,a&&(!o||o.fid!==a.fid)&&vh(t,a.fid),a})}function Nr(t){return g(this,null,function*(){let e,n=yield vi(t.appConfig,i=>{let s=j_(i),r=z_(t,s);return e=r.registrationPromise,r.installationEntry});return n.fid===Ar?{installationEntry:yield e}:{installationEntry:n,registrationPromise:e}})}function j_(t){let e=t||{fid:M_(),registrationStatus:0};return Th(e)}function z_(t,e){if(e.registrationStatus===0){if(!navigator.onLine){let s=Promise.reject(et.create("app-offline"));return{installationEntry:e,registrationPromise:s}}let n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=V_(t,n);return{installationEntry:n,registrationPromise:i}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:q_(t)}:{installationEntry:e}}function V_(t,e){return g(this,null,function*(){try{let n=yield O_(t,e);return gi(t.appConfig,n)}catch(n){throw hh(n)&&n.customData.serverCode===409?yield Eh(t.appConfig):yield gi(t.appConfig,{fid:e.fid,registrationStatus:0}),n}})}function q_(t){return g(this,null,function*(){let e=yield rh(t.appConfig);for(;e.registrationStatus===1;)yield gh(100),e=yield rh(t.appConfig);if(e.registrationStatus===0){let{installationEntry:n,registrationPromise:i}=yield Nr(t);return i||n}return e})}function rh(t){return vi(t,e=>{if(!e)throw et.create("installation-not-found");return Th(e)})}function Th(t){return H_(t)?{fid:t.fid,registrationStatus:0}:t}function H_(t){return t.registrationStatus===1&&t.registrationTime+ch<Date.now()}function G_(i,s){return g(this,arguments,function*({appConfig:t,heartbeatServiceProvider:e},n){let r=K_(t,n),o=k_(t,n),a=e.getImmediate({optional:!0});if(a){let u=yield a.getHeartbeatsHeader();u&&o.append("x-firebase-client",u)}let c={installation:{sdkVersion:lh,appId:t.appId}},l={method:"POST",headers:o,body:JSON.stringify(c)},h=yield mh(()=>fetch(r,l));if(h.ok){let u=yield h.json();return fh(u)}else throw yield ph("Generate Auth Token",h)})}function K_(t,{fid:e}){return`${dh(t)}/${e}/authTokens:generate`}function Pr(t,e=!1){return g(this,null,function*(){let n,i=yield vi(t.appConfig,r=>{if(!Ch(r))throw et.create("not-registered");let o=r.authToken;if(!e&&X_(o))return r;if(o.requestStatus===1)return n=Y_(t,e),r;{if(!navigator.onLine)throw et.create("app-offline");let a=J_(r);return n=Q_(t,a),a}});return n?yield n:i.authToken})}function Y_(t,e){return g(this,null,function*(){let n=yield oh(t.appConfig);for(;n.authToken.requestStatus===1;)yield gh(100),n=yield oh(t.appConfig);let i=n.authToken;return i.requestStatus===0?Pr(t,e):i})}function oh(t){return vi(t,e=>{if(!Ch(e))throw et.create("not-registered");let n=e.authToken;return em(n)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}function Q_(t,e){return g(this,null,function*(){try{let n=yield G_(t,e),i=Object.assign(Object.assign({},e),{authToken:n});return yield gi(t.appConfig,i),n}catch(n){if(hh(n)&&(n.customData.serverCode===401||n.customData.serverCode===404))yield Eh(t.appConfig);else{let i=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});yield gi(t.appConfig,i)}throw n}})}function Ch(t){return t!==void 0&&t.registrationStatus===2}function X_(t){return t.requestStatus===2&&!Z_(t)}function Z_(t){let e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+I_}function J_(t){let e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}function em(t){return t.requestStatus===1&&t.requestTime+ch<Date.now()}function tm(t){return g(this,null,function*(){let e=t,{installationEntry:n,registrationPromise:i}=yield Nr(e);return i?i.catch(console.error):Pr(e).catch(console.error),n.fid})}function nm(t,e=!1){return g(this,null,function*(){let n=t;return yield im(n),(yield Pr(n,e)).token})}function im(t){return g(this,null,function*(){let{registrationPromise:e}=yield Nr(t);e&&(yield e)})}function sm(t){if(!t||!t.options)throw br("App Configuration");if(!t.name)throw br("App Name");let e=["projectId","apiKey","appId"];for(let n of e)if(!t.options[n])throw br(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function br(t){return et.create("missing-app-config-values",{valueName:t})}var Sh="installations",rm="installations-internal",om=t=>{let e=t.getProvider("app").getImmediate(),n=sm(e),i=Me(e,"heartbeat");return{app:e,appConfig:n,heartbeatServiceProvider:i,_delete:()=>Promise.resolve()}},am=t=>{let e=t.getProvider("app").getImmediate(),n=Me(e,Sh).getImmediate();return{getId:()=>tm(n),getToken:s=>nm(n,s)}};function cm(){Ne(new ke(Sh,om,"PUBLIC")),Ne(new ke(rm,am,"PRIVATE"))}cm();$(ah,Rr);$(ah,Rr,"esm2017");var lm="/firebase-messaging-sw.js",um="/firebase-cloud-messaging-push-scope",Nh="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",hm="https://fcmregistrations.googleapis.com/v1",Ph="google.c.a.c_id",dm="google.c.a.c_l",fm="google.c.a.ts",pm="google.c.a.e";var wi=function(t){return t.PUSH_RECEIVED="push-received",t.NOTIFICATION_CLICKED="notification-clicked",t}(wi||{});function Ue(t){let e=new Uint8Array(t);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function _m(t){let e="=".repeat((4-t.length%4)%4),n=(t+e).replace(/\-/g,"+").replace(/_/g,"/"),i=atob(n),s=new Uint8Array(i.length);for(let r=0;r<i.length;++r)s[r]=i.charCodeAt(r);return s}var Or="fcm_token_details_db",mm=5,Ih="fcm_token_object_Store";function gm(t){return g(this,null,function*(){if("databases"in indexedDB&&!(yield indexedDB.databases()).map(r=>r.name).includes(Or))return null;let e=null;return(yield Bt(Or,mm,{upgrade:(i,s,r,o)=>g(this,null,function*(){var a;if(s<2||!i.objectStoreNames.contains(Ih))return;let c=o.objectStore(Ih),l=yield c.index("fcmSenderId").get(t);if(yield c.clear(),!!l){if(s===2){let h=l;if(!h.auth||!h.p256dh||!h.endpoint)return;e={token:h.fcmToken,createTime:(a=h.createTime)!==null&&a!==void 0?a:Date.now(),subscriptionOptions:{auth:h.auth,p256dh:h.p256dh,endpoint:h.endpoint,swScope:h.swScope,vapidKey:typeof h.vapidKey=="string"?h.vapidKey:Ue(h.vapidKey)}}}else if(s===3){let h=l;e={token:h.fcmToken,createTime:h.createTime,subscriptionOptions:{auth:Ue(h.auth),p256dh:Ue(h.p256dh),endpoint:h.endpoint,swScope:h.swScope,vapidKey:Ue(h.vapidKey)}}}else if(s===4){let h=l;e={token:h.fcmToken,createTime:h.createTime,subscriptionOptions:{auth:Ue(h.auth),p256dh:Ue(h.p256dh),endpoint:h.endpoint,swScope:h.swScope,vapidKey:Ue(h.vapidKey)}}}}})})).close(),yield xn(Or),yield xn("fcm_vapid_details_db"),yield xn("undefined"),ym(e)?e:null})}function ym(t){if(!t||!t.subscriptionOptions)return!1;let{subscriptionOptions:e}=t;return typeof t.createTime=="number"&&t.createTime>0&&typeof t.token=="string"&&t.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}var vm="firebase-messaging-database",wm=1,fn="firebase-messaging-store",xr=null;function Oh(){return xr||(xr=Bt(vm,wm,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(fn)}}})),xr}function Em(t){return g(this,null,function*(){let e=xh(t),i=yield(yield Oh()).transaction(fn).objectStore(fn).get(e);if(i)return i;{let s=yield gm(t.appConfig.senderId);if(s)return yield Lr(t,s),s}})}function Lr(t,e){return g(this,null,function*(){let n=xh(t),s=(yield Oh()).transaction(fn,"readwrite");return yield s.objectStore(fn).put(e,n),yield s.done,e})}function xh({appConfig:t}){return t.appId}var Tm={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},se=new Pn("messaging","Messaging",Tm);function Cm(t,e){return g(this,null,function*(){let n=yield Ur(t),i=Dh(e),s={method:"POST",headers:n,body:JSON.stringify(i)},r;try{r=yield(yield fetch(Fr(t.appConfig),s)).json()}catch(o){throw se.create("token-subscribe-failed",{errorInfo:o?.toString()})}if(r.error){let o=r.error.message;throw se.create("token-subscribe-failed",{errorInfo:o})}if(!r.token)throw se.create("token-subscribe-no-token");return r.token})}function Sm(t,e){return g(this,null,function*(){let n=yield Ur(t),i=Dh(e.subscriptionOptions),s={method:"PATCH",headers:n,body:JSON.stringify(i)},r;try{r=yield(yield fetch(`${Fr(t.appConfig)}/${e.token}`,s)).json()}catch(o){throw se.create("token-update-failed",{errorInfo:o?.toString()})}if(r.error){let o=r.error.message;throw se.create("token-update-failed",{errorInfo:o})}if(!r.token)throw se.create("token-update-no-token");return r.token})}function Im(t,e){return g(this,null,function*(){let i={method:"DELETE",headers:yield Ur(t)};try{let r=yield(yield fetch(`${Fr(t.appConfig)}/${e}`,i)).json();if(r.error){let o=r.error.message;throw se.create("token-unsubscribe-failed",{errorInfo:o})}}catch(s){throw se.create("token-unsubscribe-failed",{errorInfo:s?.toString()})}})}function Fr({projectId:t}){return`${hm}/projects/${t}/registrations`}function Ur(n){return g(this,arguments,function*({appConfig:t,installations:e}){let i=yield e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t.apiKey,"x-goog-firebase-installations-auth":`FIS ${i}`})})}function Dh({p256dh:t,auth:e,endpoint:n,vapidKey:i}){let s={web:{endpoint:n,auth:e,p256dh:t}};return i!==Nh&&(s.web.applicationPubKey=i),s}var bm=7*24*60*60*1e3;function Am(t){return g(this,null,function*(){let e=yield km(t.swRegistration,t.vapidKey),n={vapidKey:t.vapidKey,swScope:t.swRegistration.scope,endpoint:e.endpoint,auth:Ue(e.getKey("auth")),p256dh:Ue(e.getKey("p256dh"))},i=yield Em(t.firebaseDependencies);if(i){if(Nm(i.subscriptionOptions,n))return Date.now()>=i.createTime+bm?Rm(t,{token:i.token,createTime:Date.now(),subscriptionOptions:n}):i.token;try{yield Im(t.firebaseDependencies,i.token)}catch(s){console.warn(s)}return bh(t.firebaseDependencies,n)}else return bh(t.firebaseDependencies,n)})}function Rm(t,e){return g(this,null,function*(){try{let n=yield Sm(t.firebaseDependencies,e),i=Object.assign(Object.assign({},e),{token:n,createTime:Date.now()});return yield Lr(t.firebaseDependencies,i),n}catch(n){throw n}})}function bh(t,e){return g(this,null,function*(){let i={token:yield Cm(t,e),createTime:Date.now(),subscriptionOptions:e};return yield Lr(t,i),i.token})}function km(t,e){return g(this,null,function*(){let n=yield t.pushManager.getSubscription();return n||t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:_m(e)})})}function Nm(t,e){let n=e.vapidKey===t.vapidKey,i=e.endpoint===t.endpoint,s=e.auth===t.auth,r=e.p256dh===t.p256dh;return n&&i&&s&&r}function Ah(t){let e={from:t.from,collapseKey:t.collapse_key,messageId:t.fcmMessageId};return Pm(e,t),Om(e,t),xm(e,t),e}function Pm(t,e){if(!e.notification)return;t.notification={};let n=e.notification.title;n&&(t.notification.title=n);let i=e.notification.body;i&&(t.notification.body=i);let s=e.notification.image;s&&(t.notification.image=s);let r=e.notification.icon;r&&(t.notification.icon=r)}function Om(t,e){e.data&&(t.data=e.data)}function xm(t,e){var n,i,s,r,o;if(!e.fcmOptions&&!(!((n=e.notification)===null||n===void 0)&&n.click_action))return;t.fcmOptions={};let a=(s=(i=e.fcmOptions)===null||i===void 0?void 0:i.link)!==null&&s!==void 0?s:(r=e.notification)===null||r===void 0?void 0:r.click_action;a&&(t.fcmOptions.link=a);let c=(o=e.fcmOptions)===null||o===void 0?void 0:o.analytics_label;c&&(t.fcmOptions.analyticsLabel=c)}function Dm(t){return typeof t=="object"&&!!t&&Ph in t}Mm("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");function Mm(t,e){let n=[];for(let i=0;i<t.length;i++)n.push(t.charAt(i)),i<e.length&&n.push(e.charAt(i));return n.join("")}function Lm(t){if(!t||!t.options)throw Dr("App Configuration Object");if(!t.name)throw Dr("App Name");let e=["projectId","apiKey","appId","messagingSenderId"],{options:n}=t;for(let i of e)if(!n[i])throw Dr(i);return{appName:t.name,projectId:n.projectId,apiKey:n.apiKey,appId:n.appId,senderId:n.messagingSenderId}}function Dr(t){return se.create("missing-app-config-values",{valueName:t})}var Mr=class{constructor(e,n,i){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;let s=Lm(e);this.firebaseDependencies={app:e,appConfig:s,installations:n,analyticsProvider:i}}_delete(){return Promise.resolve()}};function Fm(t){return g(this,null,function*(){try{t.swRegistration=yield navigator.serviceWorker.register(lm,{scope:um}),t.swRegistration.update().catch(()=>{})}catch(e){throw se.create("failed-service-worker-registration",{browserErrorMessage:e?.message})}})}function Um(t,e){return g(this,null,function*(){if(!e&&!t.swRegistration&&(yield Fm(t)),!(!e&&t.swRegistration)){if(!(e instanceof ServiceWorkerRegistration))throw se.create("invalid-sw-registration");t.swRegistration=e}})}function Bm(t,e){return g(this,null,function*(){e?t.vapidKey=e:t.vapidKey||(t.vapidKey=Nh)})}function Wm(t,e){return g(this,null,function*(){if(!navigator)throw se.create("only-available-in-window");if(Notification.permission==="default"&&(yield Notification.requestPermission()),Notification.permission!=="granted")throw se.create("permission-blocked");return yield Bm(t,e?.vapidKey),yield Um(t,e?.serviceWorkerRegistration),Am(t)})}function $m(t,e,n){return g(this,null,function*(){let i=jm(e);(yield t.firebaseDependencies.analyticsProvider.get()).logEvent(i,{message_id:n[Ph],message_name:n[dm],message_time:n[fm],message_device_time:Math.floor(Date.now()/1e3)})})}function jm(t){switch(t){case wi.NOTIFICATION_CLICKED:return"notification_open";case wi.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}function zm(t,e){return g(this,null,function*(){let n=e.data;if(!n.isFirebaseMessaging)return;t.onMessageHandler&&n.messageType===wi.PUSH_RECEIVED&&(typeof t.onMessageHandler=="function"?t.onMessageHandler(Ah(n)):t.onMessageHandler.next(Ah(n)));let i=n.data;Dm(i)&&i[pm]==="1"&&(yield $m(t,n.messageType,i))})}var Rh="@firebase/messaging",kh="0.12.12";var Vm=t=>{let e=new Mr(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),t.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",n=>zm(e,n)),e},qm=t=>{let e=t.getProvider("messaging").getImmediate();return{getToken:i=>Wm(e,i)}};function Hm(){Ne(new ke("messaging",Vm,"PUBLIC")),Ne(new ke("messaging-internal",qm,"PRIVATE")),$(Rh,kh),$(Rh,kh,"esm2017")}function Br(){return g(this,null,function*(){try{yield Va()}catch{return!1}return typeof window<"u"&&za()&&qa()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")})}function Mh(t=qe()){return Br().then(e=>{if(!e)throw se.create("unsupported-browser")},e=>{throw se.create("indexed-db-unsupported")}),Me(Ve(t),"messaging").getImmediate()}Hm();var pn=class{constructor(e){return e}},Lh="messaging",Wr=class{constructor(){return lt(Lh)}};var Fh="__angularfire_symbol__messagingIsSupported",$r="__angularfire_symbol__messagingIsSupportedValue";globalThis[Fh]||=Br().then(t=>globalThis[$r]=t).catch(()=>globalThis[$r]=!1);var Ei={async:()=>globalThis[Fh],sync:()=>{let t=globalThis[$r];if(t===void 0)throw new Error(ec("Messaging"));return t}},jr=new re("angularfire2.messaging-instances");function Gm(t,e){if(!Ei.sync())return null;let n=ct(Lh,t,e);return n&&new pn(n)}function Km(t){return(e,n)=>{if(!Ei.sync())return null;let i=e.runOutsideAngular(()=>t(n));return new pn(i)}}var Ym={provide:Wr,deps:[[new ce,jr]]},Qm={provide:pn,useFactory:Gm,deps:[[new ce,jr],dt]};function Uh(t,...e){return $("angularfire",at.full,"fcm"),ue([Qm,Ym,{provide:ko,useValue:Ei.async,multi:!0},{provide:jr,useFactory:Km(t),multi:!0,deps:[Se,it,ut,ft,...e]}])}var Yw=Ei.async;var Bh=ht(Mh,!0);var qh="firebasestorage.googleapis.com",Xm="storageBucket",Zm=2*60*1e3,Jm=10*60*1e3;var De=class t extends Nn{constructor(e,n,i=0){super(zr(e),`Firebase Storage: ${n} (${zr(e)})`),this.status_=i,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,t.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return zr(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}},We=function(t){return t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment",t}(We||{});function zr(t){return"storage/"+t}function eg(){let t="An unknown error occurred, please check the error payload for server response.";return new De(We.UNKNOWN,t)}function tg(){return new De(We.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function ng(){return new De(We.CANCELED,"User canceled the upload/download.")}function ig(t){return new De(We.INVALID_URL,"Invalid URL '"+t+"'.")}function sg(t){return new De(We.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function Wh(t){return new De(We.INVALID_ARGUMENT,t)}function Hh(){return new De(We.APP_DELETED,"The Firebase app was deleted.")}function rg(t){return new De(We.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}var Be=class t{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let i;try{i=t.makeFromUrl(e,n)}catch{return new t(e,"")}if(i.path==="")return i;throw sg(e)}static makeFromUrl(e,n){let i=null,s="([A-Za-z0-9.\\-_]+)";function r(y){y.path.charAt(y.path.length-1)==="/"&&(y.path_=y.path_.slice(0,-1))}let o="(/(.*))?$",a=new RegExp("^gs://"+s+o,"i"),c={bucket:1,path:3};function l(y){y.path_=decodeURIComponent(y.path)}let h="v[A-Za-z0-9_]+",u=n.replace(/[.]/g,"\\."),d="(/([^?#]*).*)?$",_=new RegExp(`^https?://${u}/${h}/b/${s}/o${d}`,"i"),f={bucket:1,path:3},m=n===qh?"(?:storage.googleapis.com|storage.cloud.google.com)":n,w="([^?#]*)",N=new RegExp(`^https?://${m}/${s}/${w}`,"i"),V=[{regex:a,indices:c,postModify:r},{regex:_,indices:f,postModify:l},{regex:N,indices:{bucket:1,path:2},postModify:l}];for(let y=0;y<V.length;y++){let R=V[y],S=R.regex.exec(e);if(S){let Ee=S[R.indices.bucket],ee=S[R.indices.path];ee||(ee=""),i=new t(Ee,ee),R.postModify(i);break}}if(i==null)throw ig(e);return i}},Vr=class{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}};function og(t,e,n){let i=1,s=null,r=null,o=!1,a=0;function c(){return a===2}let l=!1;function h(...w){l||(l=!0,e.apply(null,w))}function u(w){s=setTimeout(()=>{s=null,t(_,c())},w)}function d(){r&&clearTimeout(r)}function _(w,...N){if(l){d();return}if(w){d(),h.call(null,w,...N);return}if(c()||o){d(),h.call(null,w,...N);return}i<64&&(i*=2);let V;a===1?(a=2,V=0):V=(i+Math.random())*1e3,u(V)}let f=!1;function m(w){f||(f=!0,d(),!l&&(s!==null?(w||(a=2),clearTimeout(s),u(0)):w||(a=1)))}return u(0),r=setTimeout(()=>{o=!0,m(!0)},n),m}function ag(t){t(!1)}function cg(t){return t!==void 0}function $h(t,e,n,i){if(i<e)throw Wh(`Invalid value for '${t}'. Expected ${e} or greater.`);if(i>n)throw Wh(`Invalid value for '${t}'. Expected ${n} or less.`)}function lg(t){let e=encodeURIComponent,n="?";for(let i in t)if(t.hasOwnProperty(i)){let s=e(i)+"="+e(t[i]);n=n+s+"&"}return n=n.slice(0,-1),n}var qr=function(t){return t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT",t}(qr||{});function ug(t,e){let n=t>=500&&t<600,s=[408,429].indexOf(t)!==-1,r=e.indexOf(t)!==-1;return n||s||r}var Hr=class{constructor(e,n,i,s,r,o,a,c,l,h,u,d=!0){this.url_=e,this.method_=n,this.headers_=i,this.body_=s,this.successCodes_=r,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=c,this.timeout_=l,this.progressCallback_=h,this.connectionFactory_=u,this.retry=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((_,f)=>{this.resolve_=_,this.reject_=f,this.start_()})}start_(){let e=(i,s)=>{if(s){i(!1,new Pt(!1,null,!0));return}let r=this.connectionFactory_();this.pendingConnection_=r;let o=a=>{let c=a.loaded,l=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,l)};this.progressCallback_!==null&&r.addUploadProgressListener(o),r.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&r.removeUploadProgressListener(o),this.pendingConnection_=null;let a=r.getErrorCode()===qr.NO_ERROR,c=r.getStatus();if(!a||ug(c,this.additionalRetryCodes_)&&this.retry){let h=r.getErrorCode()===qr.ABORT;i(!1,new Pt(!1,null,h));return}let l=this.successCodes_.indexOf(c)!==-1;i(!0,new Pt(l,r))})},n=(i,s)=>{let r=this.resolve_,o=this.reject_,a=s.connection;if(s.wasSuccessCode)try{let c=this.callback_(a,a.getResponse());cg(c)?r(c):r()}catch(c){o(c)}else if(a!==null){let c=eg();c.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,c)):o(c)}else if(s.canceled){let c=this.appDelete_?Hh():ng();o(c)}else{let c=tg();o(c)}};this.canceled_?n(!1,new Pt(!1,null,!0)):this.backoffId_=og(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&ag(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}},Pt=class{constructor(e,n,i){this.wasSuccessCode=e,this.connection=n,this.canceled=!!i}};function hg(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function dg(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function fg(t,e){e&&(t["X-Firebase-GMPID"]=e)}function pg(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function _g(t,e,n,i,s,r,o=!0){let a=lg(t.urlParams),c=t.url+a,l=Object.assign({},t.headers);return fg(l,e),hg(l,n),dg(l,r),pg(l,i),new Hr(c,t.method,l,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,s,o)}function mg(t){if(t.length===0)return null;let e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function gg(t){let e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}var tE=256*1024;var Gr=class t{constructor(e,n){this._service=e,n instanceof Be?this._location=n:this._location=Be.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new t(e,n)}get root(){let e=new Be(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return gg(this._location.path)}get storage(){return this._service}get parent(){let e=mg(this._location.path);if(e===null)return null;let n=new Be(this._location.bucket,e);return new t(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw rg(e)}};function jh(t,e){let n=e?.[Xm];return n==null?null:Be.makeFromBucketSpec(n,t)}function yg(t,e,n,i={}){t.host=`${e}:${n}`,t._protocol="http";let{mockUserToken:s}=i;s&&(t._overrideAuthToken=typeof s=="string"?s:kn(s,t.app.options.projectId))}var Kr=class{constructor(e,n,i,s,r){this.app=e,this._authProvider=n,this._appCheckProvider=i,this._url=s,this._firebaseVersion=r,this._bucket=null,this._host=qh,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Zm,this._maxUploadRetryTime=Jm,this._requests=new Set,s!=null?this._bucket=Be.makeFromBucketSpec(s,this._host):this._bucket=jh(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Be.makeFromBucketSpec(this._url,e):this._bucket=jh(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){$h("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){$h("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){return g(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let n=yield e.getToken();if(n!==null)return n.accessToken}return null})}_getAppCheckToken(){return g(this,null,function*(){let e=this._appCheckProvider.getImmediate({optional:!0});return e?(yield e.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Gr(this,e)}_makeRequest(e,n,i,s,r=!0){if(this._deleted)return new Vr(Hh());{let o=_g(e,this._appId,i,s,n,this._firebaseVersion,r);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}makeRequestWithTokens(e,n){return g(this,null,function*(){let[i,s]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,i,s).getPromise()})}},zh="@firebase/storage",Vh="0.13.2";var Gh="storage";function Kh(t=qe(),e){t=Ve(t);let i=Me(t,Gh).getImmediate({identifier:e}),s=Rn("storage");return s&&Yh(i,...s),i}function Yh(t,e,n,i={}){yg(t,e,n,i)}function vg(t,{instanceIdentifier:e}){let n=t.getProvider("app").getImmediate(),i=t.getProvider("auth-internal"),s=t.getProvider("app-check-internal");return new Kr(n,i,s,e,Dn)}function wg(){Ne(new ke(Gh,vg,"PUBLIC").setMultipleInstances(!0)),$(zh,Vh,""),$(zh,Vh,"esm2017")}wg();var _n=class{constructor(e){return e}},Qh="storage",Yr=class{constructor(){return lt(Qh)}};var Qr=new re("angularfire2.storage-instances");function Eg(t,e){let n=ct(Qh,t,e);return n&&new _n(n)}function Tg(t){return(e,n)=>{let i=e.runOutsideAngular(()=>t(n));return new _n(i)}}var Cg={provide:Yr,deps:[[new ce,Qr]]},Sg={provide:_n,useFactory:Eg,deps:[[new ce,Qr],dt]};function Xh(t,...e){return $("angularfire",at.full,"gcs"),ue([Sg,Cg,{provide:Qr,useFactory:Tg(t),multi:!0,deps:[Se,it,ut,ft,[new ce,Ln],[new ce,Mn],...e]}])}var Zh=ht(Kh,!0);Po(dc);var Jh=(()=>{let e=class e{};e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=Ce({type:e,bootstrap:[wc]}),e.\u0275inj=Te({providers:[Tc(),{provide:Mo,useClass:sl,multi:!0},Lo(Uo(),Fo([rl,ol])),tc(()=>nc(qi.firebaseConfig)),ic(()=>sc()),ih(()=>sh()),Uh(()=>Bh()),Xh(()=>Zh()),mc(_c())],imports:[Vi,Vi.initializeApp(qi.firebaseConfig),fc,jo,yc,Ec,rc,Mt.forRoot({},{metaReducers:ul}),Mt.forFeature(uc),Mt.forFeature(Ua),Mt.forFeature(ds),pc.forRoot([il,fl]),xc.forRoot(),nl.instrument({maxAge:25,logOnly:!wn()}),Bo,na]});let t=e;return t})();$o().bootstrapModule(Jh).catch(t=>console.error(t));
